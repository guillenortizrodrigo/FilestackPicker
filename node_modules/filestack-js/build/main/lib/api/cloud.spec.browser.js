"use strict";
/*
 * Copyright (c) 2019 by Filestack.
 * Some rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var config_1 = require("./../../config");
var cloud_1 = require("./cloud");
var utils = require("./../utils");
var nock = require("nock");
var store_1 = require("../utils/store");
var testApiKey = 'API_KEY';
var testTokSession = 'TOK_SESSION';
var testTokArchiveId = 'ARCHIVE_ID';
var testCloudToken = 'testCloudToken';
var testSecurity = {
    policy: 'examplePolicy',
    signature: 'exampleSignature',
};
var sessionURls = config_1.config.urls;
var testSession = {
    apikey: testApiKey,
    urls: sessionURls,
};
var scope = nock(sessionURls.cloudApiUrl);
scope.defaultReplyHeaders({
    'access-control-allow-origin': function (req) { return req.headers['origin']; },
    'access-control-allow-methods': function (req) { return req.headers['access-control-request-method']; },
    'access-control-allow-headers': function (req) { return req.headers['access-control-request-headers']; },
    'content-type': 'application/json',
});
var mockTokInit = jest
    .fn()
    .mockName('tokInit')
    .mockReturnValue('init');
var mockTokStart = jest
    .fn()
    .mockName('tokStart')
    .mockReturnValue('start');
var mockTokStop = jest
    .fn()
    .mockName('tokStop')
    .mockReturnValue('stop');
var mockMetadata = jest
    .fn()
    .mockName('metadata')
    .mockReturnValue('metadata');
var mockList = jest
    .fn()
    .mockName('list')
    .mockImplementation(function (data) {
    if (data && data.clouds.token) {
        return { token: testCloudToken };
    }
    return data;
});
var mockLogout = jest
    .fn()
    .mockName('logout')
    .mockImplementation(function (url, params) {
    if (params.clouds && params.clouds.token) {
        return { token: testCloudToken };
    }
    return params;
});
var mockStore = jest
    .fn()
    .mockName('store')
    .mockImplementation(function (params) {
    if (params && params.clouds && params.clouds.token) {
        return JSON.stringify({ token: testCloudToken });
    }
    return JSON.stringify(params);
});
describe('cloud', function () {
    beforeEach(function () {
        scope
            .persist()
            .options(/.*/)
            .reply(204, '', {
            'access-control-allow-headers': 'filestack-source,filestack-trace-id,filestack-trace-span',
            'access-control-allow-methods': '*',
            'access-control-allow-origin': '*',
        });
        scope.post('/auth/logout').reply(200, mockLogout);
        scope.post('/folder/list').reply(200, function (_, data) { return mockList(data); });
        scope.post('/store/').reply(200, function (_, data) { return mockStore(data); });
        scope.post('/metadata').reply(200, mockMetadata);
        scope.post(/\/recording\/(audio|video)\/init/).reply(200, mockTokInit);
        scope.post(/\/recording\/(audio|video)\/start/).reply(200, mockTokStart);
        scope.post(/\/recording\/(audio|video)\/stop/).reply(200, mockTokStop);
    });
    afterEach(function () {
        nock.cleanAll();
        jest.clearAllMocks();
        localStorage.clear();
    });
    describe('cancelToken', function () {
        var testDomain = 'http://delay.filestack.test';
        var scopeD;
        beforeEach(function () {
            scopeD = nock(testDomain);
            scopeD
                .post('/store/')
                .delay(4000)
                .reply(200);
            scopeD
                .post('/folder/list')
                .delay(4000)
                .reply(200);
            scopeD
                .persist()
                .options(/.*/)
                .reply(204, '', {
                'access-control-allow-headers': 'filestack-source,filestack-trace-id,filestack-trace-span',
                'access-control-allow-methods': '*',
                'access-control-allow-origin': '*',
            });
        });
        afterEach(function () {
            nock.cleanAll();
            jest.clearAllMocks();
            localStorage.clear();
        });
        it('Should cancel store request', function (done) {
            var sessionClone = JSON.parse(JSON.stringify(testSession));
            sessionClone.urls.cloudApiUrl = testDomain;
            var token = {};
            new cloud_1.CloudClient(sessionClone)
                .store('google', 'test', { filename: '1', location: 'gcs' }, {}, token)
                .then(function () {
                done('Request not canceled');
            })
                .catch(function (err) {
                expect(err).toEqual(expect.any(Error));
                done();
            });
            setTimeout(function () {
                // @ts-ignore
                token.cancel();
            }, 500);
        });
        it('Should cancel list request', function (done) {
            var sessionClone = JSON.parse(JSON.stringify(testSession));
            sessionClone.urls.cloudApiUrl = testDomain;
            var token = {};
            new cloud_1.CloudClient(sessionClone)
                .list('google', token)
                .then(function () {
                done('Request not canceled');
            })
                .catch(function (err) {
                expect(err).toEqual(expect.any(Error));
                done();
            });
            setTimeout(function () {
                // @ts-ignore
                token.cancel();
            }, 500);
        });
    });
    describe('facebook inapp browser', function () {
        it('should set token to sessionStore when inapp browser is detected', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
            var client, token, store;
            return tslib_1.__generator(this, function (_a) {
                spyOn(utils, 'isFacebook').and.returnValue(true);
                client = new cloud_1.CloudClient(Object.assign({}, testSession, {
                    prefetch: {
                        settings: {
                            inapp_browser: true,
                        },
                        pickerOptions: {},
                    },
                }));
                token = 'test';
                client.token = token;
                store = new store_1.Store();
                expect(store.getItem(cloud_1.PICKER_KEY, store_1.STORE_TYPE.SESSION)).toEqual(token);
                store.setItem(cloud_1.PICKER_KEY, undefined, store_1.STORE_TYPE.SESSION);
                return [2 /*return*/];
            });
        }); });
        it('should get token from sessionStore when inapp browser is detected', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
            var client, store, token;
            return tslib_1.__generator(this, function (_a) {
                spyOn(utils, 'isFacebook').and.returnValue(true);
                client = new cloud_1.CloudClient(Object.assign({}, testSession, {
                    prefetch: {
                        settings: {
                            inapp_browser: true,
                        },
                        pickerOptions: {},
                    },
                }));
                store = new store_1.Store();
                token = 'test';
                store.setItem(cloud_1.PICKER_KEY, token, store_1.STORE_TYPE.SESSION);
                expect(client.token).toEqual(token);
                store.setItem(cloud_1.PICKER_KEY, undefined, store_1.STORE_TYPE.SESSION);
                return [2 /*return*/];
            });
        }); });
        it('should send appurl in list action', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
            var clouds, client, res;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        clouds = { test: true };
                        client = new cloud_1.CloudClient(Object.assign({}, testSession, {
                            prefetch: {
                                settings: {
                                    inapp_browser: true,
                                },
                                pickerOptions: {},
                            },
                        }));
                        return [4 /*yield*/, client.list(tslib_1.__assign({}, clouds))];
                    case 1:
                        res = _a.sent();
                        expect(res).toEqual({
                            apikey: testApiKey,
                            flow: 'web',
                            appurl: 'http://localhost/?fs-tab=init',
                            clouds: clouds,
                            token: null,
                        });
                        return [2 /*return*/];
                }
            });
        }); });
        it('should send pass mimetypes to backend as string', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
            var clouds, client, res;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        clouds = { test: true };
                        client = new cloud_1.CloudClient(Object.assign({}, testSession, {
                            prefetch: {
                                settings: {
                                    inapp_browser: true,
                                },
                                pickerOptions: {},
                            },
                        }));
                        return [4 /*yield*/, client.list(tslib_1.__assign({}, clouds), {}, 'image/*')];
                    case 1:
                        res = _a.sent();
                        expect(res).toEqual({
                            apikey: testApiKey,
                            flow: 'web',
                            appurl: 'http://localhost/?fs-tab=init',
                            clouds: clouds,
                            token: null,
                            accept: ['image/*'],
                        });
                        return [2 /*return*/];
                }
            });
        }); });
        it('should send pass mimetypes to backend as array', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
            var clouds, client, res;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        clouds = { test: true };
                        client = new cloud_1.CloudClient(Object.assign({}, testSession, {
                            prefetch: {
                                settings: {
                                    inapp_browser: true,
                                },
                                pickerOptions: {},
                            },
                        }));
                        return [4 /*yield*/, client.list(tslib_1.__assign({}, clouds), {}, ['image/*'])];
                    case 1:
                        res = _a.sent();
                        expect(res).toEqual({
                            apikey: testApiKey,
                            flow: 'web',
                            appurl: 'http://localhost/?fs-tab=init',
                            clouds: clouds,
                            token: null,
                            accept: ['image/*'],
                        });
                        return [2 /*return*/];
                }
            });
        }); });
    });
    it('should not send app url if urlsearch params is undefined', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
        var clouds, before, client, res;
        return tslib_1.__generator(this, function (_a) {
            switch (_a.label) {
                case 0:
                    clouds = { test: true };
                    before = window.URLSearchParams;
                    window.URLSearchParams = undefined;
                    client = new cloud_1.CloudClient(Object.assign({}, testSession, {
                        prefetch: {
                            settings: {
                                inapp_browser: true,
                            },
                            pickerOptions: {},
                        },
                    }));
                    return [4 /*yield*/, client.list(tslib_1.__assign({}, clouds))];
                case 1:
                    res = _a.sent();
                    expect(res).toEqual({
                        apikey: testApiKey,
                        flow: 'web',
                        clouds: clouds,
                        token: null,
                    });
                    window.URLSearchParams = before;
                    return [2 /*return*/];
            }
        });
    }); });
    describe('list', function () {
        it('should make correct list request', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
            var clouds, res;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        clouds = { test: true };
                        return [4 /*yield*/, new cloud_1.CloudClient(testSession).list(tslib_1.__assign({}, clouds))];
                    case 1:
                        res = _a.sent();
                        expect(res).toEqual({
                            apikey: testApiKey,
                            flow: 'web',
                            clouds: clouds,
                        });
                        return [2 /*return*/];
                }
            });
        }); });
        it('should make correct list request with session cache', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
            var clouds, res;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        clouds = { test: true };
                        localStorage.setItem(cloud_1.PICKER_KEY, testCloudToken);
                        return [4 /*yield*/, new cloud_1.CloudClient(testSession, {
                                sessionCache: true,
                            }).list(tslib_1.__assign({}, clouds))];
                    case 1:
                        res = _a.sent();
                        expect(res).toEqual({
                            apikey: testApiKey,
                            flow: 'web',
                            token: testCloudToken,
                            clouds: clouds,
                        });
                        return [2 /*return*/];
                }
            });
        }); });
        it('should set token on api token response', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
            var clouds, res;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        clouds = { token: true };
                        return [4 /*yield*/, new cloud_1.CloudClient(testSession).list(tslib_1.__assign({}, clouds))];
                    case 1:
                        res = _a.sent();
                        expect(res).toEqual({ token: testCloudToken });
                        return [2 /*return*/];
                }
            });
        }); });
        it('should cache session token to local storage', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
            var clouds, res;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        clouds = { token: true };
                        return [4 /*yield*/, new cloud_1.CloudClient(testSession, { sessionCache: true }).list(tslib_1.__assign({}, clouds))];
                    case 1:
                        res = _a.sent();
                        expect(localStorage.setItem).toHaveBeenCalledWith(cloud_1.PICKER_KEY, testCloudToken);
                        expect(res).toEqual({ token: testCloudToken });
                        return [2 /*return*/];
                }
            });
        }); });
        it('should make correct list request with security', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
            var clouds, res;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        clouds = { test: true };
                        return [4 /*yield*/, new cloud_1.CloudClient(tslib_1.__assign(tslib_1.__assign({}, testSession), testSecurity)).list(tslib_1.__assign({}, clouds))];
                    case 1:
                        res = _a.sent();
                        expect(res).toEqual(tslib_1.__assign({ apikey: testApiKey, flow: 'web', clouds: clouds }, testSecurity));
                        return [2 /*return*/];
                }
            });
        }); });
    });
    describe('store', function () {
        it('should make correct basic request', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
            var res;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, new cloud_1.CloudClient(testSession).store('google', 'test', { filename: '1' })];
                    case 1:
                        res = _a.sent();
                        expect(res).toEqual({
                            apikey: testApiKey,
                            flow: 'web',
                            clouds: {
                                google: {
                                    path: 'test',
                                    store: {
                                        filename: '1',
                                        location: 's3',
                                    },
                                },
                            },
                        });
                        return [2 /*return*/];
                }
            });
        }); });
        it('should respect store location param', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
            var res;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, new cloud_1.CloudClient(testSession).store('google', 'test', { filename: '1', location: 'gcs' })];
                    case 1:
                        res = _a.sent();
                        expect(res).toEqual({
                            apikey: testApiKey,
                            flow: 'web',
                            clouds: {
                                google: {
                                    path: 'test',
                                    store: {
                                        filename: '1',
                                        location: 'gcs',
                                    },
                                },
                            },
                        });
                        return [2 /*return*/];
                }
            });
        }); });
        it('should respect store upload tags', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
            var uploadTags, res;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        uploadTags = { testTag: 'testTag' };
                        return [4 /*yield*/, new cloud_1.CloudClient(testSession).store('google', 'test', {}, null, null, uploadTags)];
                    case 1:
                        res = _a.sent();
                        expect(res).toEqual({
                            apikey: testApiKey,
                            flow: 'web',
                            upload_tags: uploadTags,
                            clouds: {
                                google: {
                                    path: 'test',
                                    store: {
                                        location: 's3',
                                    },
                                },
                            },
                        });
                        return [2 /*return*/];
                }
            });
        }); });
        it('should make correct basic with security', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
            var res, excepted;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, new cloud_1.CloudClient(tslib_1.__assign(tslib_1.__assign({}, testSession), testSecurity)).store('token', 'test', { filename: '1' })];
                    case 1:
                        res = _a.sent();
                        excepted = tslib_1.__assign(tslib_1.__assign({}, testSecurity), { apikey: testApiKey, flow: 'web', clouds: {
                                token: {
                                    path: 'test',
                                    store: {
                                        filename: '1',
                                        location: 's3',
                                    },
                                },
                            } });
                        expect(mockStore).toHaveBeenCalledWith(excepted);
                        expect(res).toEqual(testCloudToken);
                        return [2 /*return*/];
                }
            });
        }); });
        it('should handle custom source', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
            var customSource, res;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        customSource = {
                            customSourcePath: 'cs_path',
                            customSourceContainer: 'cs_container',
                        };
                        return [4 /*yield*/, new cloud_1.CloudClient(testSession).store('customsource', 'test', { filename: '1' }, customSource)];
                    case 1:
                        res = _a.sent();
                        expect(res).toEqual({
                            apikey: testApiKey,
                            flow: 'web',
                            clouds: {
                                customsource: tslib_1.__assign(tslib_1.__assign({}, customSource), { path: 'test', store: {
                                        filename: '1',
                                        location: 's3',
                                    } }),
                            },
                        });
                        return [2 /*return*/];
                }
            });
        }); });
    });
    describe('logout', function () {
        it('should make correct request to logout', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
            var _a;
            return tslib_1.__generator(this, function (_b) {
                switch (_b.label) {
                    case 0:
                        _a = expect;
                        return [4 /*yield*/, new cloud_1.CloudClient(testSession).logout()];
                    case 1:
                        _a.apply(void 0, [_b.sent()]).toEqual({ apikey: 'API_KEY', flow: 'web' });
                        return [2 /*return*/];
                }
            });
        }); });
        it('should make correct request to logout with provided cloud', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
            var _a;
            return tslib_1.__generator(this, function (_b) {
                switch (_b.label) {
                    case 0:
                        _a = expect;
                        return [4 /*yield*/, new cloud_1.CloudClient(testSession).logout('google')];
                    case 1:
                        _a.apply(void 0, [_b.sent()]).toEqual({ apikey: 'API_KEY', flow: 'web', clouds: { google: {} } });
                        return [2 /*return*/];
                }
            });
        }); });
        it('should make correct request to logout and return correct response when cloud name is returned', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
            var _a;
            return tslib_1.__generator(this, function (_b) {
                switch (_b.label) {
                    case 0:
                        _a = expect;
                        return [4 /*yield*/, new cloud_1.CloudClient(testSession).logout('token')];
                    case 1:
                        _a.apply(void 0, [_b.sent()]).toEqual('testCloudToken');
                        return [2 /*return*/];
                }
            });
        }); });
        it('should make correct request to logout and clean session cache ', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
            var res;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        localStorage.setItem(cloud_1.PICKER_KEY, testCloudToken);
                        return [4 /*yield*/, new cloud_1.CloudClient(testSession, { sessionCache: true }).logout()];
                    case 1:
                        res = _a.sent();
                        expect(localStorage.removeItem).toHaveBeenCalledWith(cloud_1.PICKER_KEY);
                        expect(res).toEqual({ apikey: 'API_KEY', flow: 'web', token: testCloudToken });
                        return [2 /*return*/];
                }
            });
        }); });
    });
    describe('metadata', function () {
        it('should make correct request', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
            var testUrl, res;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        testUrl = 'http://test.com';
                        return [4 /*yield*/, new cloud_1.CloudClient(testSession).metadata(testUrl)];
                    case 1:
                        res = _a.sent();
                        expect(mockMetadata).toHaveBeenCalledWith(expect.any(String), {
                            apikey: testApiKey,
                            url: testUrl,
                        });
                        expect(res).toEqual('metadata');
                        return [2 /*return*/];
                }
            });
        }); });
        it('should make correct request with security', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
            var testUrl, res;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        testUrl = 'http://test.com';
                        return [4 /*yield*/, new cloud_1.CloudClient(tslib_1.__assign(tslib_1.__assign({}, testSession), testSecurity)).metadata(testUrl)];
                    case 1:
                        res = _a.sent();
                        expect(mockMetadata).toHaveBeenCalledWith(expect.any(String), tslib_1.__assign({ apikey: testApiKey, url: testUrl }, testSecurity));
                        expect(res).toEqual('metadata');
                        return [2 /*return*/];
                }
            });
        }); });
    });
    describe('OpenTok', function () {
        describe('tokInit', function () {
            it('should make correct request to api (audio)', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
                var res;
                return tslib_1.__generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4 /*yield*/, new cloud_1.CloudClient(testSession).tokInit('audio')];
                        case 1:
                            res = _a.sent();
                            expect(mockTokInit).toHaveBeenCalledWith(expect.any(String), '');
                            expect(res).toEqual('init');
                            return [2 /*return*/];
                    }
                });
            }); });
            it('should make correct request to api (video)', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
                var res;
                return tslib_1.__generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4 /*yield*/, new cloud_1.CloudClient(testSession).tokInit('audio')];
                        case 1:
                            res = _a.sent();
                            expect(mockTokInit).toHaveBeenCalledWith(expect.any(String), '');
                            expect(res).toEqual('init');
                            return [2 /*return*/];
                    }
                });
            }); });
            it('should throw on wrong type', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
                return tslib_1.__generator(this, function (_a) {
                    expect(function () {
                        new cloud_1.CloudClient(testSession)
                            .tokInit('videoa')
                            .then(function () {
                            console.log('init');
                        })
                            .catch(function () {
                            console.log('err');
                        });
                    }).toThrowError();
                    return [2 /*return*/];
                });
            }); });
        });
        describe('tokStart', function () {
            it('should make correct request to api (audio)', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
                var res;
                return tslib_1.__generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4 /*yield*/, new cloud_1.CloudClient(testSession).tokStart('audio', 'key', testTokSession)];
                        case 1:
                            res = _a.sent();
                            expect(mockTokStart).toHaveBeenCalledWith(expect.any(String), { apikey: 'key', session_id: testTokSession });
                            expect(res).toEqual('start');
                            return [2 /*return*/];
                    }
                });
            }); });
            it('should make correct request to api (video)', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
                var res;
                return tslib_1.__generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4 /*yield*/, new cloud_1.CloudClient(testSession).tokStart('video', 'key', testTokSession)];
                        case 1:
                            res = _a.sent();
                            expect(mockTokStart).toHaveBeenCalledWith(expect.any(String), { apikey: 'key', session_id: testTokSession });
                            expect(res).toEqual('start');
                            return [2 /*return*/];
                    }
                });
            }); });
            it('should throw on wrong type', function () {
                expect(function () { return new cloud_1.CloudClient(testSession).tokStart('videoa', 'key', testTokSession); }).toThrowError();
            });
        });
        describe('tokStop', function () {
            it('should make correct request to api (audio)', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
                var res;
                return tslib_1.__generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4 /*yield*/, new cloud_1.CloudClient(testSession).tokStop('audio', 'key', testTokSession, testTokArchiveId)];
                        case 1:
                            res = _a.sent();
                            expect(mockTokStop).toHaveBeenCalledWith(expect.any(String), {
                                apikey: 'key',
                                session_id: testTokSession,
                                archive_id: testTokArchiveId,
                            });
                            expect(res).toEqual('stop');
                            return [2 /*return*/];
                    }
                });
            }); });
            it('should make correct request to api (video)', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
                var res;
                return tslib_1.__generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4 /*yield*/, new cloud_1.CloudClient(testSession).tokStop('video', 'key', testTokSession, testTokArchiveId)];
                        case 1:
                            res = _a.sent();
                            expect(mockTokStop).toHaveBeenCalledWith(expect.any(String), {
                                apikey: 'key',
                                session_id: testTokSession,
                                archive_id: testTokArchiveId,
                            });
                            expect(res).toEqual('stop');
                            return [2 /*return*/];
                    }
                });
            }); });
            it('should throw on wrong type', function () {
                expect(function () { return new cloud_1.CloudClient(testSession).tokStop('videoa', 'key', testTokSession, testTokArchiveId); }).toThrowError();
            });
        });
    });
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9saWIvYXBpL2Nsb3VkLnNwZWMuYnJvd3Nlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7Ozs7Ozs7Ozs7Ozs7OztHQWVHOzs7QUFFSCx5Q0FBd0M7QUFDeEMsaUNBQWtEO0FBQ2xELGtDQUFvQztBQUNwQywyQkFBNkI7QUFDN0Isd0NBQW1EO0FBRW5ELElBQU0sVUFBVSxHQUFHLFNBQVMsQ0FBQztBQUM3QixJQUFNLGNBQWMsR0FBRyxhQUFhLENBQUM7QUFDckMsSUFBTSxnQkFBZ0IsR0FBRyxZQUFZLENBQUM7QUFFdEMsSUFBTSxjQUFjLEdBQUcsZ0JBQWdCLENBQUM7QUFFeEMsSUFBTSxZQUFZLEdBQUc7SUFDbkIsTUFBTSxFQUFFLGVBQWU7SUFDdkIsU0FBUyxFQUFFLGtCQUFrQjtDQUM5QixDQUFDO0FBRUYsSUFBTSxXQUFXLEdBQUcsZUFBTSxDQUFDLElBQUksQ0FBQztBQUNoQyxJQUFNLFdBQVcsR0FBRztJQUNsQixNQUFNLEVBQUUsVUFBVTtJQUNsQixJQUFJLEVBQUUsV0FBVztDQUNsQixDQUFDO0FBRUYsSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxXQUFXLENBQUMsQ0FBQztBQUUxQyxLQUFLLENBQUMsbUJBQW1CLENBQUM7SUFDeEIsNkJBQTZCLEVBQUUsVUFBQSxHQUFHLElBQUksT0FBQSxHQUFHLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxFQUFyQixDQUFxQjtJQUMzRCw4QkFBOEIsRUFBRSxVQUFBLEdBQUcsSUFBSSxPQUFBLEdBQUcsQ0FBQyxPQUFPLENBQUMsK0JBQStCLENBQUMsRUFBNUMsQ0FBNEM7SUFDbkYsOEJBQThCLEVBQUUsVUFBQSxHQUFHLElBQUksT0FBQSxHQUFHLENBQUMsT0FBTyxDQUFDLGdDQUFnQyxDQUFDLEVBQTdDLENBQTZDO0lBQ3BGLGNBQWMsRUFBRSxrQkFBa0I7Q0FDbkMsQ0FBQyxDQUFDO0FBRUgsSUFBTSxXQUFXLEdBQUcsSUFBSTtLQUNyQixFQUFFLEVBQUU7S0FDSixRQUFRLENBQUMsU0FBUyxDQUFDO0tBQ25CLGVBQWUsQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUUzQixJQUFNLFlBQVksR0FBRyxJQUFJO0tBQ3RCLEVBQUUsRUFBRTtLQUNKLFFBQVEsQ0FBQyxVQUFVLENBQUM7S0FDcEIsZUFBZSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0FBRTVCLElBQU0sV0FBVyxHQUFHLElBQUk7S0FDckIsRUFBRSxFQUFFO0tBQ0osUUFBUSxDQUFDLFNBQVMsQ0FBQztLQUNuQixlQUFlLENBQUMsTUFBTSxDQUFDLENBQUM7QUFFM0IsSUFBTSxZQUFZLEdBQUcsSUFBSTtLQUN0QixFQUFFLEVBQUU7S0FDSixRQUFRLENBQUMsVUFBVSxDQUFDO0tBQ3BCLGVBQWUsQ0FBQyxVQUFVLENBQUMsQ0FBQztBQUUvQixJQUFNLFFBQVEsR0FBRyxJQUFJO0tBQ2xCLEVBQUUsRUFBRTtLQUNKLFFBQVEsQ0FBQyxNQUFNLENBQUM7S0FDaEIsa0JBQWtCLENBQUMsVUFBQSxJQUFJO0lBQ3RCLElBQUksSUFBSSxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFO1FBQzdCLE9BQU8sRUFBRSxLQUFLLEVBQUUsY0FBYyxFQUFFLENBQUM7S0FDbEM7SUFFRCxPQUFPLElBQUksQ0FBQztBQUNkLENBQUMsQ0FBQyxDQUFDO0FBRUwsSUFBTSxVQUFVLEdBQUcsSUFBSTtLQUNwQixFQUFFLEVBQUU7S0FDSixRQUFRLENBQUMsUUFBUSxDQUFDO0tBQ2xCLGtCQUFrQixDQUFDLFVBQUMsR0FBRyxFQUFFLE1BQU07SUFDOUIsSUFBSSxNQUFNLENBQUMsTUFBTSxJQUFJLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFO1FBQ3hDLE9BQU8sRUFBRSxLQUFLLEVBQUUsY0FBYyxFQUFFLENBQUM7S0FDbEM7SUFFRCxPQUFPLE1BQU0sQ0FBQztBQUNoQixDQUFDLENBQUMsQ0FBQztBQUVMLElBQU0sU0FBUyxHQUFHLElBQUk7S0FDbkIsRUFBRSxFQUFFO0tBQ0osUUFBUSxDQUFDLE9BQU8sQ0FBQztLQUNqQixrQkFBa0IsQ0FBQyxVQUFBLE1BQU07SUFDeEIsSUFBSSxNQUFNLElBQUksTUFBTSxDQUFDLE1BQU0sSUFBSSxNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRTtRQUNsRCxPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsRUFBRSxLQUFLLEVBQUUsY0FBYyxFQUFFLENBQUMsQ0FBQztLQUNsRDtJQUVELE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUNoQyxDQUFDLENBQUMsQ0FBQztBQUVMLFFBQVEsQ0FBQyxPQUFPLEVBQUU7SUFDaEIsVUFBVSxDQUFDO1FBQ1QsS0FBSzthQUNGLE9BQU8sRUFBRTthQUNULE9BQU8sQ0FBQyxJQUFJLENBQUM7YUFDYixLQUFLLENBQUMsR0FBRyxFQUFFLEVBQUUsRUFBRTtZQUNkLDhCQUE4QixFQUFFLDBEQUEwRDtZQUMxRiw4QkFBOEIsRUFBRSxHQUFHO1lBQ25DLDZCQUE2QixFQUFFLEdBQUc7U0FDbkMsQ0FBQyxDQUFDO1FBRUwsS0FBSyxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQyxLQUFLLENBQUMsR0FBRyxFQUFFLFVBQVUsQ0FBQyxDQUFDO1FBQ2xELEtBQUssQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsRUFBRSxVQUFDLENBQUMsRUFBRSxJQUFJLElBQUssT0FBQSxRQUFRLENBQUMsSUFBSSxDQUFDLEVBQWQsQ0FBYyxDQUFDLENBQUM7UUFDbkUsS0FBSyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxLQUFLLENBQUMsR0FBRyxFQUFFLFVBQUMsQ0FBQyxFQUFFLElBQUksSUFBSyxPQUFBLFNBQVMsQ0FBQyxJQUFJLENBQUMsRUFBZixDQUFlLENBQUMsQ0FBQztRQUMvRCxLQUFLLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLEVBQUUsWUFBWSxDQUFDLENBQUM7UUFFakQsS0FBSyxDQUFDLElBQUksQ0FBQyxrQ0FBa0MsQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLEVBQUUsV0FBVyxDQUFDLENBQUM7UUFDdkUsS0FBSyxDQUFDLElBQUksQ0FBQyxtQ0FBbUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLEVBQUUsWUFBWSxDQUFDLENBQUM7UUFDekUsS0FBSyxDQUFDLElBQUksQ0FBQyxrQ0FBa0MsQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLEVBQUUsV0FBVyxDQUFDLENBQUM7SUFDekUsQ0FBQyxDQUFDLENBQUM7SUFFSCxTQUFTLENBQUM7UUFDUixJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDaEIsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQ3JCLFlBQVksQ0FBQyxLQUFLLEVBQUUsQ0FBQztJQUN2QixDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxhQUFhLEVBQUU7UUFDdEIsSUFBTSxVQUFVLEdBQUcsNkJBQTZCLENBQUM7UUFDakQsSUFBSSxNQUFNLENBQUM7UUFFWCxVQUFVLENBQUM7WUFDVCxNQUFNLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBRTFCLE1BQU07aUJBQ0gsSUFBSSxDQUFDLFNBQVMsQ0FBQztpQkFDZixLQUFLLENBQUMsSUFBSSxDQUFDO2lCQUNYLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUNkLE1BQU07aUJBQ0gsSUFBSSxDQUFDLGNBQWMsQ0FBQztpQkFDcEIsS0FBSyxDQUFDLElBQUksQ0FBQztpQkFDWCxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7WUFFZCxNQUFNO2lCQUNILE9BQU8sRUFBRTtpQkFDVCxPQUFPLENBQUMsSUFBSSxDQUFDO2lCQUNiLEtBQUssQ0FBQyxHQUFHLEVBQUUsRUFBRSxFQUFFO2dCQUNkLDhCQUE4QixFQUFFLDBEQUEwRDtnQkFDMUYsOEJBQThCLEVBQUUsR0FBRztnQkFDbkMsNkJBQTZCLEVBQUUsR0FBRzthQUNuQyxDQUFDLENBQUM7UUFDUCxDQUFDLENBQUMsQ0FBQztRQUVILFNBQVMsQ0FBQztZQUNSLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztZQUNoQixJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7WUFDckIsWUFBWSxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ3ZCLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLDZCQUE2QixFQUFFLFVBQUEsSUFBSTtZQUNwQyxJQUFNLFlBQVksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQztZQUM3RCxZQUFZLENBQUMsSUFBSSxDQUFDLFdBQVcsR0FBRyxVQUFVLENBQUM7WUFFM0MsSUFBSSxLQUFLLEdBQUcsRUFBRSxDQUFDO1lBRWYsSUFBSSxtQkFBVyxDQUFDLFlBQVksQ0FBQztpQkFDMUIsS0FBSyxDQUFDLFFBQVEsRUFBRSxNQUFNLEVBQUUsRUFBRSxRQUFRLEVBQUUsR0FBRyxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUUsRUFBRSxFQUFFLEVBQUUsS0FBSyxDQUFDO2lCQUN0RSxJQUFJLENBQUM7Z0JBQ0osSUFBSSxDQUFDLHNCQUFzQixDQUFDLENBQUM7WUFDL0IsQ0FBQyxDQUFDO2lCQUNELEtBQUssQ0FBQyxVQUFBLEdBQUc7Z0JBQ1IsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7Z0JBQ3ZDLElBQUksRUFBRSxDQUFDO1lBQ1QsQ0FBQyxDQUFDLENBQUM7WUFFTCxVQUFVLENBQUM7Z0JBQ1QsYUFBYTtnQkFDYixLQUFLLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDakIsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1FBQ1YsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsNEJBQTRCLEVBQUUsVUFBQSxJQUFJO1lBQ25DLElBQU0sWUFBWSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDO1lBQzdELFlBQVksQ0FBQyxJQUFJLENBQUMsV0FBVyxHQUFHLFVBQVUsQ0FBQztZQUUzQyxJQUFJLEtBQUssR0FBRyxFQUFFLENBQUM7WUFFZixJQUFJLG1CQUFXLENBQUMsWUFBWSxDQUFDO2lCQUMxQixJQUFJLENBQUMsUUFBUSxFQUFFLEtBQUssQ0FBQztpQkFDckIsSUFBSSxDQUFDO2dCQUNKLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO1lBQy9CLENBQUMsQ0FBQztpQkFDRCxLQUFLLENBQUMsVUFBQSxHQUFHO2dCQUNSLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO2dCQUN2QyxJQUFJLEVBQUUsQ0FBQztZQUNULENBQUMsQ0FBQyxDQUFDO1lBRUwsVUFBVSxDQUFDO2dCQUNULGFBQWE7Z0JBQ2IsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDO1lBQ2pCLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQztRQUNWLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsd0JBQXdCLEVBQUU7UUFDakMsRUFBRSxDQUFDLGlFQUFpRSxFQUFFOzs7Z0JBQ3BFLEtBQUssQ0FBQyxLQUFLLEVBQUUsWUFBWSxDQUFDLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFFM0MsTUFBTSxHQUFHLElBQUksbUJBQVcsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRSxXQUFXLEVBQUU7b0JBQzVELFFBQVEsRUFBRTt3QkFDUixRQUFRLEVBQUU7NEJBQ1IsYUFBYSxFQUFFLElBQUk7eUJBQ3BCO3dCQUNELGFBQWEsRUFBRSxFQUFFO3FCQUNsQjtpQkFDRixDQUFDLENBQUMsQ0FBQztnQkFFRSxLQUFLLEdBQUcsTUFBTSxDQUFDO2dCQUNyQixNQUFNLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztnQkFFZixLQUFLLEdBQUcsSUFBSSxhQUFLLEVBQUUsQ0FBQztnQkFFMUIsTUFBTSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsa0JBQVUsRUFBRSxrQkFBVSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDO2dCQUNyRSxLQUFLLENBQUMsT0FBTyxDQUFDLGtCQUFVLEVBQUUsU0FBUyxFQUFFLGtCQUFVLENBQUMsT0FBTyxDQUFDLENBQUM7OzthQUMxRCxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsbUVBQW1FLEVBQUU7OztnQkFDdEUsS0FBSyxDQUFDLEtBQUssRUFBRSxZQUFZLENBQUMsQ0FBQyxHQUFHLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUUzQyxNQUFNLEdBQUcsSUFBSSxtQkFBVyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLFdBQVcsRUFBRTtvQkFDNUQsUUFBUSxFQUFFO3dCQUNSLFFBQVEsRUFBRTs0QkFDUixhQUFhLEVBQUUsSUFBSTt5QkFDcEI7d0JBQ0QsYUFBYSxFQUFFLEVBQUU7cUJBQ2xCO2lCQUNGLENBQUMsQ0FBQyxDQUFDO2dCQUVFLEtBQUssR0FBRyxJQUFJLGFBQUssRUFBRSxDQUFDO2dCQUVwQixLQUFLLEdBQUcsTUFBTSxDQUFDO2dCQUNyQixLQUFLLENBQUMsT0FBTyxDQUFDLGtCQUFVLEVBQUUsS0FBSyxFQUFFLGtCQUFVLENBQUMsT0FBTyxDQUFDLENBQUM7Z0JBRXJELE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDO2dCQUNwQyxLQUFLLENBQUMsT0FBTyxDQUFDLGtCQUFVLEVBQUUsU0FBUyxFQUFFLGtCQUFVLENBQUMsT0FBTyxDQUFDLENBQUM7OzthQUMxRCxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsbUNBQW1DLEVBQUU7Ozs7O3dCQUNoQyxNQUFNLEdBQUcsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLENBQUM7d0JBRXhCLE1BQU0sR0FBRyxJQUFJLG1CQUFXLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsV0FBVyxFQUFFOzRCQUM1RCxRQUFRLEVBQUU7Z0NBQ1IsUUFBUSxFQUFFO29DQUNSLGFBQWEsRUFBRSxJQUFJO2lDQUNwQjtnQ0FDRCxhQUFhLEVBQUUsRUFBRTs2QkFDbEI7eUJBQ0YsQ0FBQyxDQUFDLENBQUM7d0JBRVEscUJBQU0sTUFBTSxDQUFDLElBQUksc0JBQU0sTUFBTSxFQUFHLEVBQUE7O3dCQUF0QyxHQUFHLEdBQUcsU0FBZ0M7d0JBRTVDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUM7NEJBQ2xCLE1BQU0sRUFBRSxVQUFVOzRCQUNsQixJQUFJLEVBQUUsS0FBSzs0QkFDWCxNQUFNLEVBQUUsK0JBQStCOzRCQUN2QyxNQUFNLFFBQUE7NEJBQ04sS0FBSyxFQUFFLElBQUk7eUJBQ1osQ0FBQyxDQUFDOzs7O2FBQ0osQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLGlEQUFpRCxFQUFFOzs7Ozt3QkFDOUMsTUFBTSxHQUFHLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxDQUFDO3dCQUV4QixNQUFNLEdBQUcsSUFBSSxtQkFBVyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLFdBQVcsRUFBRTs0QkFDNUQsUUFBUSxFQUFFO2dDQUNSLFFBQVEsRUFBRTtvQ0FDUixhQUFhLEVBQUUsSUFBSTtpQ0FDcEI7Z0NBQ0QsYUFBYSxFQUFFLEVBQUU7NkJBQ2xCO3lCQUNGLENBQUMsQ0FBQyxDQUFDO3dCQUVRLHFCQUFNLE1BQU0sQ0FBQyxJQUFJLHNCQUFNLE1BQU0sR0FBSSxFQUFFLEVBQUUsU0FBUyxDQUFDLEVBQUE7O3dCQUFyRCxHQUFHLEdBQUcsU0FBK0M7d0JBRTNELE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUM7NEJBQ2xCLE1BQU0sRUFBRSxVQUFVOzRCQUNsQixJQUFJLEVBQUUsS0FBSzs0QkFDWCxNQUFNLEVBQUUsK0JBQStCOzRCQUN2QyxNQUFNLFFBQUE7NEJBQ04sS0FBSyxFQUFFLElBQUk7NEJBQ1gsTUFBTSxFQUFFLENBQUMsU0FBUyxDQUFDO3lCQUNwQixDQUFDLENBQUM7Ozs7YUFDSixDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsZ0RBQWdELEVBQUU7Ozs7O3dCQUM3QyxNQUFNLEdBQUcsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLENBQUM7d0JBRXhCLE1BQU0sR0FBRyxJQUFJLG1CQUFXLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsV0FBVyxFQUFFOzRCQUM1RCxRQUFRLEVBQUU7Z0NBQ1IsUUFBUSxFQUFFO29DQUNSLGFBQWEsRUFBRSxJQUFJO2lDQUNwQjtnQ0FDRCxhQUFhLEVBQUUsRUFBRTs2QkFDbEI7eUJBQ0YsQ0FBQyxDQUFDLENBQUM7d0JBRVEscUJBQU0sTUFBTSxDQUFDLElBQUksc0JBQU0sTUFBTSxHQUFJLEVBQUUsRUFBRSxDQUFDLFNBQVMsQ0FBQyxDQUFDLEVBQUE7O3dCQUF2RCxHQUFHLEdBQUcsU0FBaUQ7d0JBRTdELE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUM7NEJBQ2xCLE1BQU0sRUFBRSxVQUFVOzRCQUNsQixJQUFJLEVBQUUsS0FBSzs0QkFDWCxNQUFNLEVBQUUsK0JBQStCOzRCQUN2QyxNQUFNLFFBQUE7NEJBQ04sS0FBSyxFQUFFLElBQUk7NEJBQ1gsTUFBTSxFQUFFLENBQUMsU0FBUyxDQUFDO3lCQUNwQixDQUFDLENBQUM7Ozs7YUFDSixDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQywwREFBMEQsRUFBRTs7Ozs7b0JBQ3ZELE1BQU0sR0FBRyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsQ0FBQztvQkFFeEIsTUFBTSxHQUFHLE1BQU0sQ0FBQyxlQUFlLENBQUM7b0JBQ3RDLE1BQU0sQ0FBQyxlQUFlLEdBQUcsU0FBUyxDQUFDO29CQUU3QixNQUFNLEdBQUcsSUFBSSxtQkFBVyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLFdBQVcsRUFBRTt3QkFDNUQsUUFBUSxFQUFFOzRCQUNSLFFBQVEsRUFBRTtnQ0FDUixhQUFhLEVBQUUsSUFBSTs2QkFDcEI7NEJBQ0QsYUFBYSxFQUFFLEVBQUU7eUJBQ2xCO3FCQUNGLENBQUMsQ0FBQyxDQUFDO29CQUVRLHFCQUFNLE1BQU0sQ0FBQyxJQUFJLHNCQUFNLE1BQU0sRUFBRyxFQUFBOztvQkFBdEMsR0FBRyxHQUFHLFNBQWdDO29CQUU1QyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsT0FBTyxDQUFDO3dCQUNsQixNQUFNLEVBQUUsVUFBVTt3QkFDbEIsSUFBSSxFQUFFLEtBQUs7d0JBQ1gsTUFBTSxRQUFBO3dCQUNOLEtBQUssRUFBRSxJQUFJO3FCQUNaLENBQUMsQ0FBQztvQkFFSCxNQUFNLENBQUMsZUFBZSxHQUFHLE1BQU0sQ0FBQzs7OztTQUNqQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsTUFBTSxFQUFFO1FBQ2YsRUFBRSxDQUFDLGtDQUFrQyxFQUFFOzs7Ozt3QkFDL0IsTUFBTSxHQUFHLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxDQUFDO3dCQUVsQixxQkFBTSxJQUFJLG1CQUFXLENBQUMsV0FBVyxDQUFDLENBQUMsSUFBSSxzQkFBTSxNQUFNLEVBQUcsRUFBQTs7d0JBQTVELEdBQUcsR0FBRyxTQUFzRDt3QkFFbEUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLE9BQU8sQ0FBQzs0QkFDbEIsTUFBTSxFQUFFLFVBQVU7NEJBQ2xCLElBQUksRUFBRSxLQUFLOzRCQUNYLE1BQU0sUUFBQTt5QkFDUCxDQUFDLENBQUM7Ozs7YUFDSixDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMscURBQXFELEVBQUU7Ozs7O3dCQUNsRCxNQUFNLEdBQUcsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLENBQUM7d0JBQzlCLFlBQVksQ0FBQyxPQUFPLENBQUMsa0JBQVUsRUFBRSxjQUFjLENBQUMsQ0FBQzt3QkFFckMscUJBQU0sSUFBSSxtQkFBVyxDQUFDLFdBQVcsRUFBRTtnQ0FDN0MsWUFBWSxFQUFFLElBQUk7NkJBQ25CLENBQUMsQ0FBQyxJQUFJLHNCQUFNLE1BQU0sRUFBRyxFQUFBOzt3QkFGaEIsR0FBRyxHQUFHLFNBRVU7d0JBRXRCLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUM7NEJBQ2xCLE1BQU0sRUFBRSxVQUFVOzRCQUNsQixJQUFJLEVBQUUsS0FBSzs0QkFDWCxLQUFLLEVBQUUsY0FBYzs0QkFDckIsTUFBTSxRQUFBO3lCQUNQLENBQUMsQ0FBQzs7OzthQUNKLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyx3Q0FBd0MsRUFBRTs7Ozs7d0JBQ3JDLE1BQU0sR0FBRyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsQ0FBQzt3QkFDbkIscUJBQU0sSUFBSSxtQkFBVyxDQUFDLFdBQVcsQ0FBQyxDQUFDLElBQUksc0JBQU0sTUFBTSxFQUFHLEVBQUE7O3dCQUE1RCxHQUFHLEdBQUcsU0FBc0Q7d0JBRWxFLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsRUFBRSxLQUFLLEVBQUUsY0FBYyxFQUFFLENBQUMsQ0FBQzs7OzthQUNoRCxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsNkNBQTZDLEVBQUU7Ozs7O3dCQUMxQyxNQUFNLEdBQUcsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLENBQUM7d0JBRW5CLHFCQUFNLElBQUksbUJBQVcsQ0FBQyxXQUFXLEVBQUUsRUFBRSxZQUFZLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQyxJQUFJLHNCQUFNLE1BQU0sRUFBRyxFQUFBOzt3QkFBcEYsR0FBRyxHQUFHLFNBQThFO3dCQUUxRixNQUFNLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxDQUFDLG9CQUFvQixDQUFDLGtCQUFVLEVBQUUsY0FBYyxDQUFDLENBQUM7d0JBQzlFLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsRUFBRSxLQUFLLEVBQUUsY0FBYyxFQUFFLENBQUMsQ0FBQzs7OzthQUNoRCxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsZ0RBQWdELEVBQUU7Ozs7O3dCQUM3QyxNQUFNLEdBQUcsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLENBQUM7d0JBRWxCLHFCQUFNLElBQUksbUJBQVcsdUNBQzVCLFdBQVcsR0FDWCxZQUFZLEVBQ2YsQ0FBQyxJQUFJLHNCQUFNLE1BQU0sRUFBRyxFQUFBOzt3QkFIaEIsR0FBRyxHQUFHLFNBR1U7d0JBRXRCLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxPQUFPLG9CQUNqQixNQUFNLEVBQUUsVUFBVSxFQUNsQixJQUFJLEVBQUUsS0FBSyxFQUNYLE1BQU0sUUFBQSxJQUNILFlBQVksRUFDZixDQUFDOzs7O2FBQ0osQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsT0FBTyxFQUFFO1FBQ2hCLEVBQUUsQ0FBQyxtQ0FBbUMsRUFBRTs7Ozs0QkFDMUIscUJBQU0sSUFBSSxtQkFBVyxDQUFDLFdBQVcsQ0FBQyxDQUFDLEtBQUssQ0FBQyxRQUFRLEVBQUUsTUFBTSxFQUFFLEVBQUUsUUFBUSxFQUFFLEdBQUcsRUFBRSxDQUFDLEVBQUE7O3dCQUFuRixHQUFHLEdBQUcsU0FBNkU7d0JBRXpGLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUM7NEJBQ2xCLE1BQU0sRUFBRSxVQUFVOzRCQUNsQixJQUFJLEVBQUUsS0FBSzs0QkFDWCxNQUFNLEVBQUU7Z0NBQ04sTUFBTSxFQUFFO29DQUNOLElBQUksRUFBRSxNQUFNO29DQUNaLEtBQUssRUFBRTt3Q0FDTCxRQUFRLEVBQUUsR0FBRzt3Q0FDYixRQUFRLEVBQUUsSUFBSTtxQ0FDZjtpQ0FDRjs2QkFDRjt5QkFDRixDQUFDLENBQUM7Ozs7YUFDSixDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMscUNBQXFDLEVBQUU7Ozs7NEJBQzVCLHFCQUFNLElBQUksbUJBQVcsQ0FBQyxXQUFXLENBQUMsQ0FBQyxLQUFLLENBQUMsUUFBUSxFQUFFLE1BQU0sRUFBRSxFQUFFLFFBQVEsRUFBRSxHQUFHLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxDQUFDLEVBQUE7O3dCQUFwRyxHQUFHLEdBQUcsU0FBOEY7d0JBRTFHLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUM7NEJBQ2xCLE1BQU0sRUFBRSxVQUFVOzRCQUNsQixJQUFJLEVBQUUsS0FBSzs0QkFDWCxNQUFNLEVBQUU7Z0NBQ04sTUFBTSxFQUFFO29DQUNOLElBQUksRUFBRSxNQUFNO29DQUNaLEtBQUssRUFBRTt3Q0FDTCxRQUFRLEVBQUUsR0FBRzt3Q0FDYixRQUFRLEVBQUUsS0FBSztxQ0FDaEI7aUNBQ0Y7NkJBQ0Y7eUJBQ0YsQ0FBQyxDQUFDOzs7O2FBQ0osQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLGtDQUFrQyxFQUFFOzs7Ozt3QkFDL0IsVUFBVSxHQUFHLEVBQUUsT0FBTyxFQUFFLFNBQVMsRUFBRSxDQUFDO3dCQUU5QixxQkFBTSxJQUFJLG1CQUFXLENBQUMsV0FBVyxDQUFDLENBQUMsS0FBSyxDQUFDLFFBQVEsRUFBRSxNQUFNLEVBQUUsRUFBRSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsVUFBVSxDQUFDLEVBQUE7O3dCQUE1RixHQUFHLEdBQUcsU0FBc0Y7d0JBRWxHLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUM7NEJBQ2xCLE1BQU0sRUFBRSxVQUFVOzRCQUNsQixJQUFJLEVBQUUsS0FBSzs0QkFDWCxXQUFXLEVBQUUsVUFBVTs0QkFDdkIsTUFBTSxFQUFFO2dDQUNOLE1BQU0sRUFBRTtvQ0FDTixJQUFJLEVBQUUsTUFBTTtvQ0FDWixLQUFLLEVBQUU7d0NBQ0wsUUFBUSxFQUFFLElBQUk7cUNBQ2Y7aUNBQ0Y7NkJBQ0Y7eUJBQ0YsQ0FBQyxDQUFDOzs7O2FBQ0osQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHlDQUF5QyxFQUFFOzs7OzRCQUNoQyxxQkFBTSxJQUFJLG1CQUFXLHVDQUM1QixXQUFXLEdBQ1gsWUFBWSxFQUNmLENBQUMsS0FBSyxDQUFDLE9BQU8sRUFBRSxNQUFNLEVBQUUsRUFBRSxRQUFRLEVBQUUsR0FBRyxFQUFFLENBQUMsRUFBQTs7d0JBSHRDLEdBQUcsR0FBRyxTQUdnQzt3QkFFdEMsUUFBUSx5Q0FDVCxZQUFZLEtBQ2YsTUFBTSxFQUFFLFVBQVUsRUFDbEIsSUFBSSxFQUFFLEtBQUssRUFDWCxNQUFNLEVBQUU7Z0NBQ04sS0FBSyxFQUFFO29DQUNMLElBQUksRUFBRSxNQUFNO29DQUNaLEtBQUssRUFBRTt3Q0FDTCxRQUFRLEVBQUUsR0FBRzt3Q0FDYixRQUFRLEVBQUUsSUFBSTtxQ0FDZjtpQ0FDRjs2QkFDRixHQUNGLENBQUM7d0JBRUYsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDLG9CQUFvQixDQUFDLFFBQVEsQ0FBQyxDQUFDO3dCQUNqRCxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQyxDQUFDOzs7O2FBQ3JDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyw2QkFBNkIsRUFBRTs7Ozs7d0JBQzFCLFlBQVksR0FBRzs0QkFDbkIsZ0JBQWdCLEVBQUUsU0FBUzs0QkFDM0IscUJBQXFCLEVBQUUsY0FBYzt5QkFDdEMsQ0FBQzt3QkFFVSxxQkFBTSxJQUFJLG1CQUFXLENBQUMsV0FBVyxDQUFDLENBQUMsS0FBSyxDQUFDLGNBQWMsRUFBRSxNQUFNLEVBQUUsRUFBRSxRQUFRLEVBQUUsR0FBRyxFQUFFLEVBQUUsWUFBWSxDQUFDLEVBQUE7O3dCQUF2RyxHQUFHLEdBQUcsU0FBaUc7d0JBRTdHLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUM7NEJBQ2xCLE1BQU0sRUFBRSxVQUFVOzRCQUNsQixJQUFJLEVBQUUsS0FBSzs0QkFDWCxNQUFNLEVBQUU7Z0NBQ04sWUFBWSx3Q0FDUCxZQUFZLEtBQ2YsSUFBSSxFQUFFLE1BQU0sRUFDWixLQUFLLEVBQUU7d0NBQ0wsUUFBUSxFQUFFLEdBQUc7d0NBQ2IsUUFBUSxFQUFFLElBQUk7cUNBQ2YsR0FDRjs2QkFDRjt5QkFDRixDQUFDLENBQUM7Ozs7YUFDSixDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxRQUFRLEVBQUU7UUFDakIsRUFBRSxDQUFDLHVDQUF1QyxFQUFFOzs7Ozt3QkFDMUMsS0FBQSxNQUFNLENBQUE7d0JBQUMscUJBQU0sSUFBSSxtQkFBVyxDQUFDLFdBQVcsQ0FBQyxDQUFDLE1BQU0sRUFBRSxFQUFBOzt3QkFBbEQsa0JBQU8sU0FBMkMsRUFBQyxDQUFDLE9BQU8sQ0FBQyxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUM7Ozs7YUFDakcsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLDJEQUEyRCxFQUFFOzs7Ozt3QkFDOUQsS0FBQSxNQUFNLENBQUE7d0JBQUMscUJBQU0sSUFBSSxtQkFBVyxDQUFDLFdBQVcsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsRUFBQTs7d0JBQTFELGtCQUFPLFNBQW1ELEVBQUMsQ0FBQyxPQUFPLENBQUMsRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLEVBQUUsTUFBTSxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQzs7OzthQUNqSSxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsK0ZBQStGLEVBQUU7Ozs7O3dCQUNsRyxLQUFBLE1BQU0sQ0FBQTt3QkFBQyxxQkFBTSxJQUFJLG1CQUFXLENBQUMsV0FBVyxDQUFDLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxFQUFBOzt3QkFBekQsa0JBQU8sU0FBa0QsRUFBQyxDQUFDLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDOzs7O2FBQ3RGLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxnRUFBZ0UsRUFBRTs7Ozs7d0JBQ25FLFlBQVksQ0FBQyxPQUFPLENBQUMsa0JBQVUsRUFBRSxjQUFjLENBQUMsQ0FBQzt3QkFFckMscUJBQU0sSUFBSSxtQkFBVyxDQUFDLFdBQVcsRUFBRSxFQUFFLFlBQVksRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLE1BQU0sRUFBRSxFQUFBOzt3QkFBekUsR0FBRyxHQUFHLFNBQW1FO3dCQUUvRSxNQUFNLENBQUMsWUFBWSxDQUFDLFVBQVUsQ0FBQyxDQUFDLG9CQUFvQixDQUFDLGtCQUFVLENBQUMsQ0FBQzt3QkFDakUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsY0FBYyxFQUFFLENBQUMsQ0FBQzs7OzthQUNoRixDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxVQUFVLEVBQUU7UUFDbkIsRUFBRSxDQUFDLDZCQUE2QixFQUFFOzs7Ozt3QkFDMUIsT0FBTyxHQUFHLGlCQUFpQixDQUFDO3dCQUV0QixxQkFBTSxJQUFJLG1CQUFXLENBQUMsV0FBVyxDQUFDLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxFQUFBOzt3QkFBMUQsR0FBRyxHQUFHLFNBQW9EO3dCQUVoRSxNQUFNLENBQUMsWUFBWSxDQUFDLENBQUMsb0JBQW9CLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsRUFBRTs0QkFDNUQsTUFBTSxFQUFFLFVBQVU7NEJBQ2xCLEdBQUcsRUFBRSxPQUFPO3lCQUNiLENBQUMsQ0FBQzt3QkFDSCxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDOzs7O2FBQ2pDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQywyQ0FBMkMsRUFBRTs7Ozs7d0JBQ3hDLE9BQU8sR0FBRyxpQkFBaUIsQ0FBQzt3QkFFdEIscUJBQU0sSUFBSSxtQkFBVyx1Q0FDNUIsV0FBVyxHQUNYLFlBQVksRUFDZixDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsRUFBQTs7d0JBSGQsR0FBRyxHQUFHLFNBR1E7d0JBRXBCLE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxxQkFDMUQsTUFBTSxFQUFFLFVBQVUsRUFDbEIsR0FBRyxFQUFFLE9BQU8sSUFDVCxZQUFZLEVBQ2YsQ0FBQzt3QkFDSCxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDOzs7O2FBQ2pDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLFNBQVMsRUFBRTtRQUNsQixRQUFRLENBQUMsU0FBUyxFQUFFO1lBQ2xCLEVBQUUsQ0FBQyw0Q0FBNEMsRUFBRTs7OztnQ0FDbkMscUJBQU0sSUFBSSxtQkFBVyxDQUFDLFdBQVcsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBQTs7NEJBQXpELEdBQUcsR0FBRyxTQUFtRDs0QkFFL0QsTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDLG9CQUFvQixDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7NEJBQ2pFLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7Ozs7aUJBQzdCLENBQUMsQ0FBQztZQUVILEVBQUUsQ0FBQyw0Q0FBNEMsRUFBRTs7OztnQ0FDbkMscUJBQU0sSUFBSSxtQkFBVyxDQUFDLFdBQVcsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBQTs7NEJBQXpELEdBQUcsR0FBRyxTQUFtRDs0QkFFL0QsTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDLG9CQUFvQixDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7NEJBQ2pFLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7Ozs7aUJBQzdCLENBQUMsQ0FBQztZQUVILEVBQUUsQ0FBQyw0QkFBNEIsRUFBRTs7b0JBQy9CLE1BQU0sQ0FBQzt3QkFDTCxJQUFJLG1CQUFXLENBQUMsV0FBVyxDQUFDOzZCQUN6QixPQUFPLENBQUMsUUFBUSxDQUFDOzZCQUNqQixJQUFJLENBQUM7NEJBQ0osT0FBTyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQzt3QkFDdEIsQ0FBQyxDQUFDOzZCQUNELEtBQUssQ0FBQzs0QkFDTCxPQUFPLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDO3dCQUNyQixDQUFDLENBQUMsQ0FBQztvQkFDUCxDQUFDLENBQUMsQ0FBQyxZQUFZLEVBQUUsQ0FBQzs7O2lCQUNuQixDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUVILFFBQVEsQ0FBQyxVQUFVLEVBQUU7WUFDbkIsRUFBRSxDQUFDLDRDQUE0QyxFQUFFOzs7O2dDQUNuQyxxQkFBTSxJQUFJLG1CQUFXLENBQUMsV0FBVyxDQUFDLENBQUMsUUFBUSxDQUFDLE9BQU8sRUFBRSxLQUFLLEVBQUUsY0FBYyxDQUFDLEVBQUE7OzRCQUFqRixHQUFHLEdBQUcsU0FBMkU7NEJBRXZGLE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxVQUFVLEVBQUUsY0FBYyxFQUFFLENBQUMsQ0FBQzs0QkFDN0csTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQzs7OztpQkFDOUIsQ0FBQyxDQUFDO1lBRUgsRUFBRSxDQUFDLDRDQUE0QyxFQUFFOzs7O2dDQUNuQyxxQkFBTSxJQUFJLG1CQUFXLENBQUMsV0FBVyxDQUFDLENBQUMsUUFBUSxDQUFDLE9BQU8sRUFBRSxLQUFLLEVBQUUsY0FBYyxDQUFDLEVBQUE7OzRCQUFqRixHQUFHLEdBQUcsU0FBMkU7NEJBRXZGLE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxVQUFVLEVBQUUsY0FBYyxFQUFFLENBQUMsQ0FBQzs0QkFDN0csTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQzs7OztpQkFDOUIsQ0FBQyxDQUFDO1lBRUgsRUFBRSxDQUFDLDRCQUE0QixFQUFFO2dCQUMvQixNQUFNLENBQUMsY0FBTSxPQUFBLElBQUksbUJBQVcsQ0FBQyxXQUFXLENBQUMsQ0FBQyxRQUFRLENBQUMsUUFBUSxFQUFFLEtBQUssRUFBRSxjQUFjLENBQUMsRUFBdEUsQ0FBc0UsQ0FBQyxDQUFDLFlBQVksRUFBRSxDQUFDO1lBQ3RHLENBQUMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7UUFFSCxRQUFRLENBQUMsU0FBUyxFQUFFO1lBQ2xCLEVBQUUsQ0FBQyw0Q0FBNEMsRUFBRTs7OztnQ0FDbkMscUJBQU0sSUFBSSxtQkFBVyxDQUFDLFdBQVcsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsS0FBSyxFQUFFLGNBQWMsRUFBRSxnQkFBZ0IsQ0FBQyxFQUFBOzs0QkFBbEcsR0FBRyxHQUFHLFNBQTRGOzRCQUV4RyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUMsb0JBQW9CLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsRUFBRTtnQ0FDM0QsTUFBTSxFQUFFLEtBQUs7Z0NBQ2IsVUFBVSxFQUFFLGNBQWM7Z0NBQzFCLFVBQVUsRUFBRSxnQkFBZ0I7NkJBQzdCLENBQUMsQ0FBQzs0QkFDSCxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDOzs7O2lCQUM3QixDQUFDLENBQUM7WUFFSCxFQUFFLENBQUMsNENBQTRDLEVBQUU7Ozs7Z0NBQ25DLHFCQUFNLElBQUksbUJBQVcsQ0FBQyxXQUFXLENBQUMsQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFLEtBQUssRUFBRSxjQUFjLEVBQUUsZ0JBQWdCLENBQUMsRUFBQTs7NEJBQWxHLEdBQUcsR0FBRyxTQUE0Rjs0QkFFeEcsTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDLG9CQUFvQixDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUU7Z0NBQzNELE1BQU0sRUFBRSxLQUFLO2dDQUNiLFVBQVUsRUFBRSxjQUFjO2dDQUMxQixVQUFVLEVBQUUsZ0JBQWdCOzZCQUM3QixDQUFDLENBQUM7NEJBQ0gsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQzs7OztpQkFDN0IsQ0FBQyxDQUFDO1lBRUgsRUFBRSxDQUFDLDRCQUE0QixFQUFFO2dCQUMvQixNQUFNLENBQUMsY0FBTSxPQUFBLElBQUksbUJBQVcsQ0FBQyxXQUFXLENBQUMsQ0FBQyxPQUFPLENBQUMsUUFBUSxFQUFFLEtBQUssRUFBRSxjQUFjLEVBQUUsZ0JBQWdCLENBQUMsRUFBdkYsQ0FBdUYsQ0FBQyxDQUFDLFlBQVksRUFBRSxDQUFDO1lBQ3ZILENBQUMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwiZmlsZSI6ImxpYi9hcGkvY2xvdWQuc3BlYy5icm93c2VyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIENvcHlyaWdodCAoYykgMjAxOSBieSBGaWxlc3RhY2suXG4gKiBTb21lIHJpZ2h0cyByZXNlcnZlZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgJ0xpY2Vuc2UnKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAnQVMgSVMnIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBjb25maWcgfSBmcm9tICcuLy4uLy4uL2NvbmZpZyc7XG5pbXBvcnQgeyBDbG91ZENsaWVudCwgUElDS0VSX0tFWSB9IGZyb20gJy4vY2xvdWQnO1xuaW1wb3J0ICogYXMgdXRpbHMgZnJvbSAnLi8uLi91dGlscyc7XG5pbXBvcnQgKiBhcyBub2NrIGZyb20gJ25vY2snO1xuaW1wb3J0IHsgU3RvcmUsIFNUT1JFX1RZUEUgfSBmcm9tICcuLi91dGlscy9zdG9yZSc7XG5cbmNvbnN0IHRlc3RBcGlLZXkgPSAnQVBJX0tFWSc7XG5jb25zdCB0ZXN0VG9rU2Vzc2lvbiA9ICdUT0tfU0VTU0lPTic7XG5jb25zdCB0ZXN0VG9rQXJjaGl2ZUlkID0gJ0FSQ0hJVkVfSUQnO1xuXG5jb25zdCB0ZXN0Q2xvdWRUb2tlbiA9ICd0ZXN0Q2xvdWRUb2tlbic7XG5cbmNvbnN0IHRlc3RTZWN1cml0eSA9IHtcbiAgcG9saWN5OiAnZXhhbXBsZVBvbGljeScsXG4gIHNpZ25hdHVyZTogJ2V4YW1wbGVTaWduYXR1cmUnLFxufTtcblxuY29uc3Qgc2Vzc2lvblVSbHMgPSBjb25maWcudXJscztcbmNvbnN0IHRlc3RTZXNzaW9uID0ge1xuICBhcGlrZXk6IHRlc3RBcGlLZXksXG4gIHVybHM6IHNlc3Npb25VUmxzLFxufTtcblxubGV0IHNjb3BlID0gbm9jayhzZXNzaW9uVVJscy5jbG91ZEFwaVVybCk7XG5cbnNjb3BlLmRlZmF1bHRSZXBseUhlYWRlcnMoe1xuICAnYWNjZXNzLWNvbnRyb2wtYWxsb3ctb3JpZ2luJzogcmVxID0+IHJlcS5oZWFkZXJzWydvcmlnaW4nXSxcbiAgJ2FjY2Vzcy1jb250cm9sLWFsbG93LW1ldGhvZHMnOiByZXEgPT4gcmVxLmhlYWRlcnNbJ2FjY2Vzcy1jb250cm9sLXJlcXVlc3QtbWV0aG9kJ10sXG4gICdhY2Nlc3MtY29udHJvbC1hbGxvdy1oZWFkZXJzJzogcmVxID0+IHJlcS5oZWFkZXJzWydhY2Nlc3MtY29udHJvbC1yZXF1ZXN0LWhlYWRlcnMnXSxcbiAgJ2NvbnRlbnQtdHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbn0pO1xuXG5jb25zdCBtb2NrVG9rSW5pdCA9IGplc3RcbiAgLmZuKClcbiAgLm1vY2tOYW1lKCd0b2tJbml0JylcbiAgLm1vY2tSZXR1cm5WYWx1ZSgnaW5pdCcpO1xuXG5jb25zdCBtb2NrVG9rU3RhcnQgPSBqZXN0XG4gIC5mbigpXG4gIC5tb2NrTmFtZSgndG9rU3RhcnQnKVxuICAubW9ja1JldHVyblZhbHVlKCdzdGFydCcpO1xuXG5jb25zdCBtb2NrVG9rU3RvcCA9IGplc3RcbiAgLmZuKClcbiAgLm1vY2tOYW1lKCd0b2tTdG9wJylcbiAgLm1vY2tSZXR1cm5WYWx1ZSgnc3RvcCcpO1xuXG5jb25zdCBtb2NrTWV0YWRhdGEgPSBqZXN0XG4gIC5mbigpXG4gIC5tb2NrTmFtZSgnbWV0YWRhdGEnKVxuICAubW9ja1JldHVyblZhbHVlKCdtZXRhZGF0YScpO1xuXG5jb25zdCBtb2NrTGlzdCA9IGplc3RcbiAgLmZuKClcbiAgLm1vY2tOYW1lKCdsaXN0JylcbiAgLm1vY2tJbXBsZW1lbnRhdGlvbihkYXRhID0+IHtcbiAgICBpZiAoZGF0YSAmJiBkYXRhLmNsb3Vkcy50b2tlbikge1xuICAgICAgcmV0dXJuIHsgdG9rZW46IHRlc3RDbG91ZFRva2VuIH07XG4gICAgfVxuXG4gICAgcmV0dXJuIGRhdGE7XG4gIH0pO1xuXG5jb25zdCBtb2NrTG9nb3V0ID0gamVzdFxuICAuZm4oKVxuICAubW9ja05hbWUoJ2xvZ291dCcpXG4gIC5tb2NrSW1wbGVtZW50YXRpb24oKHVybCwgcGFyYW1zKSA9PiB7XG4gICAgaWYgKHBhcmFtcy5jbG91ZHMgJiYgcGFyYW1zLmNsb3Vkcy50b2tlbikge1xuICAgICAgcmV0dXJuIHsgdG9rZW46IHRlc3RDbG91ZFRva2VuIH07XG4gICAgfVxuXG4gICAgcmV0dXJuIHBhcmFtcztcbiAgfSk7XG5cbmNvbnN0IG1vY2tTdG9yZSA9IGplc3RcbiAgLmZuKClcbiAgLm1vY2tOYW1lKCdzdG9yZScpXG4gIC5tb2NrSW1wbGVtZW50YXRpb24ocGFyYW1zID0+IHtcbiAgICBpZiAocGFyYW1zICYmIHBhcmFtcy5jbG91ZHMgJiYgcGFyYW1zLmNsb3Vkcy50b2tlbikge1xuICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHsgdG9rZW46IHRlc3RDbG91ZFRva2VuIH0pO1xuICAgIH1cblxuICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShwYXJhbXMpO1xuICB9KTtcblxuZGVzY3JpYmUoJ2Nsb3VkJywgKCkgPT4ge1xuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBzY29wZVxuICAgICAgLnBlcnNpc3QoKVxuICAgICAgLm9wdGlvbnMoLy4qLylcbiAgICAgIC5yZXBseSgyMDQsICcnLCB7XG4gICAgICAgICdhY2Nlc3MtY29udHJvbC1hbGxvdy1oZWFkZXJzJzogJ2ZpbGVzdGFjay1zb3VyY2UsZmlsZXN0YWNrLXRyYWNlLWlkLGZpbGVzdGFjay10cmFjZS1zcGFuJyxcbiAgICAgICAgJ2FjY2Vzcy1jb250cm9sLWFsbG93LW1ldGhvZHMnOiAnKicsXG4gICAgICAgICdhY2Nlc3MtY29udHJvbC1hbGxvdy1vcmlnaW4nOiAnKicsXG4gICAgICB9KTtcblxuICAgIHNjb3BlLnBvc3QoJy9hdXRoL2xvZ291dCcpLnJlcGx5KDIwMCwgbW9ja0xvZ291dCk7XG4gICAgc2NvcGUucG9zdCgnL2ZvbGRlci9saXN0JykucmVwbHkoMjAwLCAoXywgZGF0YSkgPT4gbW9ja0xpc3QoZGF0YSkpO1xuICAgIHNjb3BlLnBvc3QoJy9zdG9yZS8nKS5yZXBseSgyMDAsIChfLCBkYXRhKSA9PiBtb2NrU3RvcmUoZGF0YSkpO1xuICAgIHNjb3BlLnBvc3QoJy9tZXRhZGF0YScpLnJlcGx5KDIwMCwgbW9ja01ldGFkYXRhKTtcblxuICAgIHNjb3BlLnBvc3QoL1xcL3JlY29yZGluZ1xcLyhhdWRpb3x2aWRlbylcXC9pbml0LykucmVwbHkoMjAwLCBtb2NrVG9rSW5pdCk7XG4gICAgc2NvcGUucG9zdCgvXFwvcmVjb3JkaW5nXFwvKGF1ZGlvfHZpZGVvKVxcL3N0YXJ0LykucmVwbHkoMjAwLCBtb2NrVG9rU3RhcnQpO1xuICAgIHNjb3BlLnBvc3QoL1xcL3JlY29yZGluZ1xcLyhhdWRpb3x2aWRlbylcXC9zdG9wLykucmVwbHkoMjAwLCBtb2NrVG9rU3RvcCk7XG4gIH0pO1xuXG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgbm9jay5jbGVhbkFsbCgpO1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICAgIGxvY2FsU3RvcmFnZS5jbGVhcigpO1xuICB9KTtcblxuICBkZXNjcmliZSgnY2FuY2VsVG9rZW4nLCAoKSA9PiB7XG4gICAgY29uc3QgdGVzdERvbWFpbiA9ICdodHRwOi8vZGVsYXkuZmlsZXN0YWNrLnRlc3QnO1xuICAgIGxldCBzY29wZUQ7XG5cbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIHNjb3BlRCA9IG5vY2sodGVzdERvbWFpbik7XG5cbiAgICAgIHNjb3BlRFxuICAgICAgICAucG9zdCgnL3N0b3JlLycpXG4gICAgICAgIC5kZWxheSg0MDAwKVxuICAgICAgICAucmVwbHkoMjAwKTtcbiAgICAgIHNjb3BlRFxuICAgICAgICAucG9zdCgnL2ZvbGRlci9saXN0JylcbiAgICAgICAgLmRlbGF5KDQwMDApXG4gICAgICAgIC5yZXBseSgyMDApO1xuXG4gICAgICBzY29wZURcbiAgICAgICAgLnBlcnNpc3QoKVxuICAgICAgICAub3B0aW9ucygvLiovKVxuICAgICAgICAucmVwbHkoMjA0LCAnJywge1xuICAgICAgICAgICdhY2Nlc3MtY29udHJvbC1hbGxvdy1oZWFkZXJzJzogJ2ZpbGVzdGFjay1zb3VyY2UsZmlsZXN0YWNrLXRyYWNlLWlkLGZpbGVzdGFjay10cmFjZS1zcGFuJyxcbiAgICAgICAgICAnYWNjZXNzLWNvbnRyb2wtYWxsb3ctbWV0aG9kcyc6ICcqJyxcbiAgICAgICAgICAnYWNjZXNzLWNvbnRyb2wtYWxsb3ctb3JpZ2luJzogJyonLFxuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgICBub2NrLmNsZWFuQWxsKCk7XG4gICAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgICAgIGxvY2FsU3RvcmFnZS5jbGVhcigpO1xuICAgIH0pO1xuXG4gICAgaXQoJ1Nob3VsZCBjYW5jZWwgc3RvcmUgcmVxdWVzdCcsIGRvbmUgPT4ge1xuICAgICAgY29uc3Qgc2Vzc2lvbkNsb25lID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0ZXN0U2Vzc2lvbikpO1xuICAgICAgc2Vzc2lvbkNsb25lLnVybHMuY2xvdWRBcGlVcmwgPSB0ZXN0RG9tYWluO1xuXG4gICAgICBsZXQgdG9rZW4gPSB7fTtcblxuICAgICAgbmV3IENsb3VkQ2xpZW50KHNlc3Npb25DbG9uZSlcbiAgICAgICAgLnN0b3JlKCdnb29nbGUnLCAndGVzdCcsIHsgZmlsZW5hbWU6ICcxJywgbG9jYXRpb246ICdnY3MnIH0sIHt9LCB0b2tlbilcbiAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgIGRvbmUoJ1JlcXVlc3Qgbm90IGNhbmNlbGVkJyk7XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaChlcnIgPT4ge1xuICAgICAgICAgIGV4cGVjdChlcnIpLnRvRXF1YWwoZXhwZWN0LmFueShFcnJvcikpO1xuICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgIHRva2VuLmNhbmNlbCgpO1xuICAgICAgfSwgNTAwKTtcbiAgICB9KTtcblxuICAgIGl0KCdTaG91bGQgY2FuY2VsIGxpc3QgcmVxdWVzdCcsIGRvbmUgPT4ge1xuICAgICAgY29uc3Qgc2Vzc2lvbkNsb25lID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0ZXN0U2Vzc2lvbikpO1xuICAgICAgc2Vzc2lvbkNsb25lLnVybHMuY2xvdWRBcGlVcmwgPSB0ZXN0RG9tYWluO1xuXG4gICAgICBsZXQgdG9rZW4gPSB7fTtcblxuICAgICAgbmV3IENsb3VkQ2xpZW50KHNlc3Npb25DbG9uZSlcbiAgICAgICAgLmxpc3QoJ2dvb2dsZScsIHRva2VuKVxuICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgICAgZG9uZSgnUmVxdWVzdCBub3QgY2FuY2VsZWQnKTtcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKGVyciA9PiB7XG4gICAgICAgICAgZXhwZWN0KGVycikudG9FcXVhbChleHBlY3QuYW55KEVycm9yKSk7XG4gICAgICAgICAgZG9uZSgpO1xuICAgICAgICB9KTtcblxuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgdG9rZW4uY2FuY2VsKCk7XG4gICAgICB9LCA1MDApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZmFjZWJvb2sgaW5hcHAgYnJvd3NlcicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHNldCB0b2tlbiB0byBzZXNzaW9uU3RvcmUgd2hlbiBpbmFwcCBicm93c2VyIGlzIGRldGVjdGVkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgc3B5T24odXRpbHMsICdpc0ZhY2Vib29rJykuYW5kLnJldHVyblZhbHVlKHRydWUpO1xuXG4gICAgICBjb25zdCBjbGllbnQgPSBuZXcgQ2xvdWRDbGllbnQoT2JqZWN0LmFzc2lnbih7fSwgdGVzdFNlc3Npb24sIHtcbiAgICAgICAgcHJlZmV0Y2g6IHtcbiAgICAgICAgICBzZXR0aW5nczoge1xuICAgICAgICAgICAgaW5hcHBfYnJvd3NlcjogdHJ1ZSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHBpY2tlck9wdGlvbnM6IHt9LFxuICAgICAgICB9LFxuICAgICAgfSkpO1xuXG4gICAgICBjb25zdCB0b2tlbiA9ICd0ZXN0JztcbiAgICAgIGNsaWVudC50b2tlbiA9IHRva2VuO1xuXG4gICAgICBjb25zdCBzdG9yZSA9IG5ldyBTdG9yZSgpO1xuXG4gICAgICBleHBlY3Qoc3RvcmUuZ2V0SXRlbShQSUNLRVJfS0VZLCBTVE9SRV9UWVBFLlNFU1NJT04pKS50b0VxdWFsKHRva2VuKTtcbiAgICAgIHN0b3JlLnNldEl0ZW0oUElDS0VSX0tFWSwgdW5kZWZpbmVkLCBTVE9SRV9UWVBFLlNFU1NJT04pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBnZXQgdG9rZW4gZnJvbSBzZXNzaW9uU3RvcmUgd2hlbiBpbmFwcCBicm93c2VyIGlzIGRldGVjdGVkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgc3B5T24odXRpbHMsICdpc0ZhY2Vib29rJykuYW5kLnJldHVyblZhbHVlKHRydWUpO1xuXG4gICAgICBjb25zdCBjbGllbnQgPSBuZXcgQ2xvdWRDbGllbnQoT2JqZWN0LmFzc2lnbih7fSwgdGVzdFNlc3Npb24sIHtcbiAgICAgICAgcHJlZmV0Y2g6IHtcbiAgICAgICAgICBzZXR0aW5nczoge1xuICAgICAgICAgICAgaW5hcHBfYnJvd3NlcjogdHJ1ZSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHBpY2tlck9wdGlvbnM6IHt9LFxuICAgICAgICB9LFxuICAgICAgfSkpO1xuXG4gICAgICBjb25zdCBzdG9yZSA9IG5ldyBTdG9yZSgpO1xuXG4gICAgICBjb25zdCB0b2tlbiA9ICd0ZXN0JztcbiAgICAgIHN0b3JlLnNldEl0ZW0oUElDS0VSX0tFWSwgdG9rZW4sIFNUT1JFX1RZUEUuU0VTU0lPTik7XG5cbiAgICAgIGV4cGVjdChjbGllbnQudG9rZW4pLnRvRXF1YWwodG9rZW4pO1xuICAgICAgc3RvcmUuc2V0SXRlbShQSUNLRVJfS0VZLCB1bmRlZmluZWQsIFNUT1JFX1RZUEUuU0VTU0lPTik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHNlbmQgYXBwdXJsIGluIGxpc3QgYWN0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgY2xvdWRzID0geyB0ZXN0OiB0cnVlIH07XG5cbiAgICAgIGNvbnN0IGNsaWVudCA9IG5ldyBDbG91ZENsaWVudChPYmplY3QuYXNzaWduKHt9LCB0ZXN0U2Vzc2lvbiwge1xuICAgICAgICBwcmVmZXRjaDoge1xuICAgICAgICAgIHNldHRpbmdzOiB7XG4gICAgICAgICAgICBpbmFwcF9icm93c2VyOiB0cnVlLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgcGlja2VyT3B0aW9uczoge30sXG4gICAgICAgIH0sXG4gICAgICB9KSk7XG5cbiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGNsaWVudC5saXN0KHsgLi4uY2xvdWRzIH0pO1xuXG4gICAgICBleHBlY3QocmVzKS50b0VxdWFsKHtcbiAgICAgICAgYXBpa2V5OiB0ZXN0QXBpS2V5LFxuICAgICAgICBmbG93OiAnd2ViJyxcbiAgICAgICAgYXBwdXJsOiAnaHR0cDovL2xvY2FsaG9zdC8/ZnMtdGFiPWluaXQnLFxuICAgICAgICBjbG91ZHMsXG4gICAgICAgIHRva2VuOiBudWxsLFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHNlbmQgcGFzcyBtaW1ldHlwZXMgdG8gYmFja2VuZCBhcyBzdHJpbmcnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjbG91ZHMgPSB7IHRlc3Q6IHRydWUgfTtcblxuICAgICAgY29uc3QgY2xpZW50ID0gbmV3IENsb3VkQ2xpZW50KE9iamVjdC5hc3NpZ24oe30sIHRlc3RTZXNzaW9uLCB7XG4gICAgICAgIHByZWZldGNoOiB7XG4gICAgICAgICAgc2V0dGluZ3M6IHtcbiAgICAgICAgICAgIGluYXBwX2Jyb3dzZXI6IHRydWUsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBwaWNrZXJPcHRpb25zOiB7fSxcbiAgICAgICAgfSxcbiAgICAgIH0pKTtcblxuICAgICAgY29uc3QgcmVzID0gYXdhaXQgY2xpZW50Lmxpc3QoeyAuLi5jbG91ZHMgfSwge30sICdpbWFnZS8qJyk7XG5cbiAgICAgIGV4cGVjdChyZXMpLnRvRXF1YWwoe1xuICAgICAgICBhcGlrZXk6IHRlc3RBcGlLZXksXG4gICAgICAgIGZsb3c6ICd3ZWInLFxuICAgICAgICBhcHB1cmw6ICdodHRwOi8vbG9jYWxob3N0Lz9mcy10YWI9aW5pdCcsXG4gICAgICAgIGNsb3VkcyxcbiAgICAgICAgdG9rZW46IG51bGwsXG4gICAgICAgIGFjY2VwdDogWydpbWFnZS8qJ10sXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgc2VuZCBwYXNzIG1pbWV0eXBlcyB0byBiYWNrZW5kIGFzIGFycmF5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgY2xvdWRzID0geyB0ZXN0OiB0cnVlIH07XG5cbiAgICAgIGNvbnN0IGNsaWVudCA9IG5ldyBDbG91ZENsaWVudChPYmplY3QuYXNzaWduKHt9LCB0ZXN0U2Vzc2lvbiwge1xuICAgICAgICBwcmVmZXRjaDoge1xuICAgICAgICAgIHNldHRpbmdzOiB7XG4gICAgICAgICAgICBpbmFwcF9icm93c2VyOiB0cnVlLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgcGlja2VyT3B0aW9uczoge30sXG4gICAgICAgIH0sXG4gICAgICB9KSk7XG5cbiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGNsaWVudC5saXN0KHsgLi4uY2xvdWRzIH0sIHt9LCBbJ2ltYWdlLyonXSk7XG5cbiAgICAgIGV4cGVjdChyZXMpLnRvRXF1YWwoe1xuICAgICAgICBhcGlrZXk6IHRlc3RBcGlLZXksXG4gICAgICAgIGZsb3c6ICd3ZWInLFxuICAgICAgICBhcHB1cmw6ICdodHRwOi8vbG9jYWxob3N0Lz9mcy10YWI9aW5pdCcsXG4gICAgICAgIGNsb3VkcyxcbiAgICAgICAgdG9rZW46IG51bGwsXG4gICAgICAgIGFjY2VwdDogWydpbWFnZS8qJ10sXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBub3Qgc2VuZCBhcHAgdXJsIGlmIHVybHNlYXJjaCBwYXJhbXMgaXMgdW5kZWZpbmVkJywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IGNsb3VkcyA9IHsgdGVzdDogdHJ1ZSB9O1xuXG4gICAgY29uc3QgYmVmb3JlID0gd2luZG93LlVSTFNlYXJjaFBhcmFtcztcbiAgICB3aW5kb3cuVVJMU2VhcmNoUGFyYW1zID0gdW5kZWZpbmVkO1xuXG4gICAgY29uc3QgY2xpZW50ID0gbmV3IENsb3VkQ2xpZW50KE9iamVjdC5hc3NpZ24oe30sIHRlc3RTZXNzaW9uLCB7XG4gICAgICBwcmVmZXRjaDoge1xuICAgICAgICBzZXR0aW5nczoge1xuICAgICAgICAgIGluYXBwX2Jyb3dzZXI6IHRydWUsXG4gICAgICAgIH0sXG4gICAgICAgIHBpY2tlck9wdGlvbnM6IHt9LFxuICAgICAgfSxcbiAgICB9KSk7XG5cbiAgICBjb25zdCByZXMgPSBhd2FpdCBjbGllbnQubGlzdCh7IC4uLmNsb3VkcyB9KTtcblxuICAgIGV4cGVjdChyZXMpLnRvRXF1YWwoe1xuICAgICAgYXBpa2V5OiB0ZXN0QXBpS2V5LFxuICAgICAgZmxvdzogJ3dlYicsXG4gICAgICBjbG91ZHMsXG4gICAgICB0b2tlbjogbnVsbCxcbiAgICB9KTtcblxuICAgIHdpbmRvdy5VUkxTZWFyY2hQYXJhbXMgPSBiZWZvcmU7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdsaXN0JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgbWFrZSBjb3JyZWN0IGxpc3QgcmVxdWVzdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGNsb3VkcyA9IHsgdGVzdDogdHJ1ZSB9O1xuXG4gICAgICBjb25zdCByZXMgPSBhd2FpdCBuZXcgQ2xvdWRDbGllbnQodGVzdFNlc3Npb24pLmxpc3QoeyAuLi5jbG91ZHMgfSk7XG5cbiAgICAgIGV4cGVjdChyZXMpLnRvRXF1YWwoe1xuICAgICAgICBhcGlrZXk6IHRlc3RBcGlLZXksXG4gICAgICAgIGZsb3c6ICd3ZWInLFxuICAgICAgICBjbG91ZHMsXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbWFrZSBjb3JyZWN0IGxpc3QgcmVxdWVzdCB3aXRoIHNlc3Npb24gY2FjaGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjbG91ZHMgPSB7IHRlc3Q6IHRydWUgfTtcbiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFBJQ0tFUl9LRVksIHRlc3RDbG91ZFRva2VuKTtcblxuICAgICAgY29uc3QgcmVzID0gYXdhaXQgbmV3IENsb3VkQ2xpZW50KHRlc3RTZXNzaW9uLCB7XG4gICAgICAgIHNlc3Npb25DYWNoZTogdHJ1ZSxcbiAgICAgIH0pLmxpc3QoeyAuLi5jbG91ZHMgfSk7XG5cbiAgICAgIGV4cGVjdChyZXMpLnRvRXF1YWwoe1xuICAgICAgICBhcGlrZXk6IHRlc3RBcGlLZXksXG4gICAgICAgIGZsb3c6ICd3ZWInLFxuICAgICAgICB0b2tlbjogdGVzdENsb3VkVG9rZW4sXG4gICAgICAgIGNsb3VkcyxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBzZXQgdG9rZW4gb24gYXBpIHRva2VuIHJlc3BvbnNlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgY2xvdWRzID0geyB0b2tlbjogdHJ1ZSB9O1xuICAgICAgY29uc3QgcmVzID0gYXdhaXQgbmV3IENsb3VkQ2xpZW50KHRlc3RTZXNzaW9uKS5saXN0KHsgLi4uY2xvdWRzIH0pO1xuXG4gICAgICBleHBlY3QocmVzKS50b0VxdWFsKHsgdG9rZW46IHRlc3RDbG91ZFRva2VuIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjYWNoZSBzZXNzaW9uIHRva2VuIHRvIGxvY2FsIHN0b3JhZ2UnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjbG91ZHMgPSB7IHRva2VuOiB0cnVlIH07XG5cbiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IG5ldyBDbG91ZENsaWVudCh0ZXN0U2Vzc2lvbiwgeyBzZXNzaW9uQ2FjaGU6IHRydWUgfSkubGlzdCh7IC4uLmNsb3VkcyB9KTtcblxuICAgICAgZXhwZWN0KGxvY2FsU3RvcmFnZS5zZXRJdGVtKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChQSUNLRVJfS0VZLCB0ZXN0Q2xvdWRUb2tlbik7XG4gICAgICBleHBlY3QocmVzKS50b0VxdWFsKHsgdG9rZW46IHRlc3RDbG91ZFRva2VuIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBtYWtlIGNvcnJlY3QgbGlzdCByZXF1ZXN0IHdpdGggc2VjdXJpdHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjbG91ZHMgPSB7IHRlc3Q6IHRydWUgfTtcblxuICAgICAgY29uc3QgcmVzID0gYXdhaXQgbmV3IENsb3VkQ2xpZW50KHtcbiAgICAgICAgLi4udGVzdFNlc3Npb24sXG4gICAgICAgIC4uLnRlc3RTZWN1cml0eSxcbiAgICAgIH0pLmxpc3QoeyAuLi5jbG91ZHMgfSk7XG5cbiAgICAgIGV4cGVjdChyZXMpLnRvRXF1YWwoe1xuICAgICAgICBhcGlrZXk6IHRlc3RBcGlLZXksXG4gICAgICAgIGZsb3c6ICd3ZWInLFxuICAgICAgICBjbG91ZHMsXG4gICAgICAgIC4uLnRlc3RTZWN1cml0eSxcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnc3RvcmUnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBtYWtlIGNvcnJlY3QgYmFzaWMgcmVxdWVzdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IG5ldyBDbG91ZENsaWVudCh0ZXN0U2Vzc2lvbikuc3RvcmUoJ2dvb2dsZScsICd0ZXN0JywgeyBmaWxlbmFtZTogJzEnIH0pO1xuXG4gICAgICBleHBlY3QocmVzKS50b0VxdWFsKHtcbiAgICAgICAgYXBpa2V5OiB0ZXN0QXBpS2V5LFxuICAgICAgICBmbG93OiAnd2ViJyxcbiAgICAgICAgY2xvdWRzOiB7XG4gICAgICAgICAgZ29vZ2xlOiB7XG4gICAgICAgICAgICBwYXRoOiAndGVzdCcsXG4gICAgICAgICAgICBzdG9yZToge1xuICAgICAgICAgICAgICBmaWxlbmFtZTogJzEnLFxuICAgICAgICAgICAgICBsb2NhdGlvbjogJ3MzJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXNwZWN0IHN0b3JlIGxvY2F0aW9uIHBhcmFtJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzID0gYXdhaXQgbmV3IENsb3VkQ2xpZW50KHRlc3RTZXNzaW9uKS5zdG9yZSgnZ29vZ2xlJywgJ3Rlc3QnLCB7IGZpbGVuYW1lOiAnMScsIGxvY2F0aW9uOiAnZ2NzJyB9KTtcblxuICAgICAgZXhwZWN0KHJlcykudG9FcXVhbCh7XG4gICAgICAgIGFwaWtleTogdGVzdEFwaUtleSxcbiAgICAgICAgZmxvdzogJ3dlYicsXG4gICAgICAgIGNsb3Vkczoge1xuICAgICAgICAgIGdvb2dsZToge1xuICAgICAgICAgICAgcGF0aDogJ3Rlc3QnLFxuICAgICAgICAgICAgc3RvcmU6IHtcbiAgICAgICAgICAgICAgZmlsZW5hbWU6ICcxJyxcbiAgICAgICAgICAgICAgbG9jYXRpb246ICdnY3MnLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlc3BlY3Qgc3RvcmUgdXBsb2FkIHRhZ3MnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB1cGxvYWRUYWdzID0geyB0ZXN0VGFnOiAndGVzdFRhZycgfTtcblxuICAgICAgY29uc3QgcmVzID0gYXdhaXQgbmV3IENsb3VkQ2xpZW50KHRlc3RTZXNzaW9uKS5zdG9yZSgnZ29vZ2xlJywgJ3Rlc3QnLCB7fSwgbnVsbCwgbnVsbCwgdXBsb2FkVGFncyk7XG5cbiAgICAgIGV4cGVjdChyZXMpLnRvRXF1YWwoe1xuICAgICAgICBhcGlrZXk6IHRlc3RBcGlLZXksXG4gICAgICAgIGZsb3c6ICd3ZWInLFxuICAgICAgICB1cGxvYWRfdGFnczogdXBsb2FkVGFncyxcbiAgICAgICAgY2xvdWRzOiB7XG4gICAgICAgICAgZ29vZ2xlOiB7XG4gICAgICAgICAgICBwYXRoOiAndGVzdCcsXG4gICAgICAgICAgICBzdG9yZToge1xuICAgICAgICAgICAgICBsb2NhdGlvbjogJ3MzJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBtYWtlIGNvcnJlY3QgYmFzaWMgd2l0aCBzZWN1cml0eScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IG5ldyBDbG91ZENsaWVudCh7XG4gICAgICAgIC4uLnRlc3RTZXNzaW9uLFxuICAgICAgICAuLi50ZXN0U2VjdXJpdHksXG4gICAgICB9KS5zdG9yZSgndG9rZW4nLCAndGVzdCcsIHsgZmlsZW5hbWU6ICcxJyB9KTtcblxuICAgICAgY29uc3QgZXhjZXB0ZWQgPSB7XG4gICAgICAgIC4uLnRlc3RTZWN1cml0eSxcbiAgICAgICAgYXBpa2V5OiB0ZXN0QXBpS2V5LFxuICAgICAgICBmbG93OiAnd2ViJyxcbiAgICAgICAgY2xvdWRzOiB7XG4gICAgICAgICAgdG9rZW46IHtcbiAgICAgICAgICAgIHBhdGg6ICd0ZXN0JyxcbiAgICAgICAgICAgIHN0b3JlOiB7XG4gICAgICAgICAgICAgIGZpbGVuYW1lOiAnMScsXG4gICAgICAgICAgICAgIGxvY2F0aW9uOiAnczMnLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfTtcblxuICAgICAgZXhwZWN0KG1vY2tTdG9yZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoZXhjZXB0ZWQpO1xuICAgICAgZXhwZWN0KHJlcykudG9FcXVhbCh0ZXN0Q2xvdWRUb2tlbik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBjdXN0b20gc291cmNlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgY3VzdG9tU291cmNlID0ge1xuICAgICAgICBjdXN0b21Tb3VyY2VQYXRoOiAnY3NfcGF0aCcsXG4gICAgICAgIGN1c3RvbVNvdXJjZUNvbnRhaW5lcjogJ2NzX2NvbnRhaW5lcicsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXMgPSBhd2FpdCBuZXcgQ2xvdWRDbGllbnQodGVzdFNlc3Npb24pLnN0b3JlKCdjdXN0b21zb3VyY2UnLCAndGVzdCcsIHsgZmlsZW5hbWU6ICcxJyB9LCBjdXN0b21Tb3VyY2UpO1xuXG4gICAgICBleHBlY3QocmVzKS50b0VxdWFsKHtcbiAgICAgICAgYXBpa2V5OiB0ZXN0QXBpS2V5LFxuICAgICAgICBmbG93OiAnd2ViJyxcbiAgICAgICAgY2xvdWRzOiB7XG4gICAgICAgICAgY3VzdG9tc291cmNlOiB7XG4gICAgICAgICAgICAuLi5jdXN0b21Tb3VyY2UsXG4gICAgICAgICAgICBwYXRoOiAndGVzdCcsXG4gICAgICAgICAgICBzdG9yZToge1xuICAgICAgICAgICAgICBmaWxlbmFtZTogJzEnLFxuICAgICAgICAgICAgICBsb2NhdGlvbjogJ3MzJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnbG9nb3V0JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgbWFrZSBjb3JyZWN0IHJlcXVlc3QgdG8gbG9nb3V0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgZXhwZWN0KGF3YWl0IG5ldyBDbG91ZENsaWVudCh0ZXN0U2Vzc2lvbikubG9nb3V0KCkpLnRvRXF1YWwoeyBhcGlrZXk6ICdBUElfS0VZJywgZmxvdzogJ3dlYicgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIG1ha2UgY29ycmVjdCByZXF1ZXN0IHRvIGxvZ291dCB3aXRoIHByb3ZpZGVkIGNsb3VkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgZXhwZWN0KGF3YWl0IG5ldyBDbG91ZENsaWVudCh0ZXN0U2Vzc2lvbikubG9nb3V0KCdnb29nbGUnKSkudG9FcXVhbCh7IGFwaWtleTogJ0FQSV9LRVknLCBmbG93OiAnd2ViJywgY2xvdWRzOiB7IGdvb2dsZToge30gfSB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbWFrZSBjb3JyZWN0IHJlcXVlc3QgdG8gbG9nb3V0IGFuZCByZXR1cm4gY29ycmVjdCByZXNwb25zZSB3aGVuIGNsb3VkIG5hbWUgaXMgcmV0dXJuZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBleHBlY3QoYXdhaXQgbmV3IENsb3VkQ2xpZW50KHRlc3RTZXNzaW9uKS5sb2dvdXQoJ3Rva2VuJykpLnRvRXF1YWwoJ3Rlc3RDbG91ZFRva2VuJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIG1ha2UgY29ycmVjdCByZXF1ZXN0IHRvIGxvZ291dCBhbmQgY2xlYW4gc2Vzc2lvbiBjYWNoZSAnLCBhc3luYyAoKSA9PiB7XG4gICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShQSUNLRVJfS0VZLCB0ZXN0Q2xvdWRUb2tlbik7XG5cbiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IG5ldyBDbG91ZENsaWVudCh0ZXN0U2Vzc2lvbiwgeyBzZXNzaW9uQ2FjaGU6IHRydWUgfSkubG9nb3V0KCk7XG5cbiAgICAgIGV4cGVjdChsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoUElDS0VSX0tFWSk7XG4gICAgICBleHBlY3QocmVzKS50b0VxdWFsKHsgYXBpa2V5OiAnQVBJX0tFWScsIGZsb3c6ICd3ZWInLCB0b2tlbjogdGVzdENsb3VkVG9rZW4gfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdtZXRhZGF0YScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIG1ha2UgY29ycmVjdCByZXF1ZXN0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdGVzdFVybCA9ICdodHRwOi8vdGVzdC5jb20nO1xuXG4gICAgICBjb25zdCByZXMgPSBhd2FpdCBuZXcgQ2xvdWRDbGllbnQodGVzdFNlc3Npb24pLm1ldGFkYXRhKHRlc3RVcmwpO1xuXG4gICAgICBleHBlY3QobW9ja01ldGFkYXRhKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChleHBlY3QuYW55KFN0cmluZyksIHtcbiAgICAgICAgYXBpa2V5OiB0ZXN0QXBpS2V5LFxuICAgICAgICB1cmw6IHRlc3RVcmwsXG4gICAgICB9KTtcbiAgICAgIGV4cGVjdChyZXMpLnRvRXF1YWwoJ21ldGFkYXRhJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIG1ha2UgY29ycmVjdCByZXF1ZXN0IHdpdGggc2VjdXJpdHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB0ZXN0VXJsID0gJ2h0dHA6Ly90ZXN0LmNvbSc7XG5cbiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IG5ldyBDbG91ZENsaWVudCh7XG4gICAgICAgIC4uLnRlc3RTZXNzaW9uLFxuICAgICAgICAuLi50ZXN0U2VjdXJpdHksXG4gICAgICB9KS5tZXRhZGF0YSh0ZXN0VXJsKTtcblxuICAgICAgZXhwZWN0KG1vY2tNZXRhZGF0YSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoZXhwZWN0LmFueShTdHJpbmcpLCB7XG4gICAgICAgIGFwaWtleTogdGVzdEFwaUtleSxcbiAgICAgICAgdXJsOiB0ZXN0VXJsLFxuICAgICAgICAuLi50ZXN0U2VjdXJpdHksXG4gICAgICB9KTtcbiAgICAgIGV4cGVjdChyZXMpLnRvRXF1YWwoJ21ldGFkYXRhJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdPcGVuVG9rJywgKCkgPT4ge1xuICAgIGRlc2NyaWJlKCd0b2tJbml0JywgKCkgPT4ge1xuICAgICAgaXQoJ3Nob3VsZCBtYWtlIGNvcnJlY3QgcmVxdWVzdCB0byBhcGkgKGF1ZGlvKScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgbmV3IENsb3VkQ2xpZW50KHRlc3RTZXNzaW9uKS50b2tJbml0KCdhdWRpbycpO1xuXG4gICAgICAgIGV4cGVjdChtb2NrVG9rSW5pdCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoZXhwZWN0LmFueShTdHJpbmcpLCAnJyk7XG4gICAgICAgIGV4cGVjdChyZXMpLnRvRXF1YWwoJ2luaXQnKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIG1ha2UgY29ycmVjdCByZXF1ZXN0IHRvIGFwaSAodmlkZW8pJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBuZXcgQ2xvdWRDbGllbnQodGVzdFNlc3Npb24pLnRva0luaXQoJ2F1ZGlvJyk7XG5cbiAgICAgICAgZXhwZWN0KG1vY2tUb2tJbml0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChleHBlY3QuYW55KFN0cmluZyksICcnKTtcbiAgICAgICAgZXhwZWN0KHJlcykudG9FcXVhbCgnaW5pdCcpO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgdGhyb3cgb24gd3JvbmcgdHlwZScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgZXhwZWN0KCgpID0+IHtcbiAgICAgICAgICBuZXcgQ2xvdWRDbGllbnQodGVzdFNlc3Npb24pXG4gICAgICAgICAgICAudG9rSW5pdCgndmlkZW9hJylcbiAgICAgICAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2luaXQnKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuY2F0Y2goKCkgPT4ge1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZygnZXJyJyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSkudG9UaHJvd0Vycm9yKCk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCd0b2tTdGFydCcsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgbWFrZSBjb3JyZWN0IHJlcXVlc3QgdG8gYXBpIChhdWRpbyknLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IG5ldyBDbG91ZENsaWVudCh0ZXN0U2Vzc2lvbikudG9rU3RhcnQoJ2F1ZGlvJywgJ2tleScsIHRlc3RUb2tTZXNzaW9uKTtcblxuICAgICAgICBleHBlY3QobW9ja1Rva1N0YXJ0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChleHBlY3QuYW55KFN0cmluZyksIHsgYXBpa2V5OiAna2V5Jywgc2Vzc2lvbl9pZDogdGVzdFRva1Nlc3Npb24gfSk7XG4gICAgICAgIGV4cGVjdChyZXMpLnRvRXF1YWwoJ3N0YXJ0Jyk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCBtYWtlIGNvcnJlY3QgcmVxdWVzdCB0byBhcGkgKHZpZGVvKScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgbmV3IENsb3VkQ2xpZW50KHRlc3RTZXNzaW9uKS50b2tTdGFydCgndmlkZW8nLCAna2V5JywgdGVzdFRva1Nlc3Npb24pO1xuXG4gICAgICAgIGV4cGVjdChtb2NrVG9rU3RhcnQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGV4cGVjdC5hbnkoU3RyaW5nKSwgeyBhcGlrZXk6ICdrZXknLCBzZXNzaW9uX2lkOiB0ZXN0VG9rU2Vzc2lvbiB9KTtcbiAgICAgICAgZXhwZWN0KHJlcykudG9FcXVhbCgnc3RhcnQnKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIHRocm93IG9uIHdyb25nIHR5cGUnLCAoKSA9PiB7XG4gICAgICAgIGV4cGVjdCgoKSA9PiBuZXcgQ2xvdWRDbGllbnQodGVzdFNlc3Npb24pLnRva1N0YXJ0KCd2aWRlb2EnLCAna2V5JywgdGVzdFRva1Nlc3Npb24pKS50b1Rocm93RXJyb3IoKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ3Rva1N0b3AnLCAoKSA9PiB7XG4gICAgICBpdCgnc2hvdWxkIG1ha2UgY29ycmVjdCByZXF1ZXN0IHRvIGFwaSAoYXVkaW8pJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBuZXcgQ2xvdWRDbGllbnQodGVzdFNlc3Npb24pLnRva1N0b3AoJ2F1ZGlvJywgJ2tleScsIHRlc3RUb2tTZXNzaW9uLCB0ZXN0VG9rQXJjaGl2ZUlkKTtcblxuICAgICAgICBleHBlY3QobW9ja1Rva1N0b3ApLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGV4cGVjdC5hbnkoU3RyaW5nKSwge1xuICAgICAgICAgIGFwaWtleTogJ2tleScsXG4gICAgICAgICAgc2Vzc2lvbl9pZDogdGVzdFRva1Nlc3Npb24sXG4gICAgICAgICAgYXJjaGl2ZV9pZDogdGVzdFRva0FyY2hpdmVJZCxcbiAgICAgICAgfSk7XG4gICAgICAgIGV4cGVjdChyZXMpLnRvRXF1YWwoJ3N0b3AnKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIG1ha2UgY29ycmVjdCByZXF1ZXN0IHRvIGFwaSAodmlkZW8pJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBuZXcgQ2xvdWRDbGllbnQodGVzdFNlc3Npb24pLnRva1N0b3AoJ3ZpZGVvJywgJ2tleScsIHRlc3RUb2tTZXNzaW9uLCB0ZXN0VG9rQXJjaGl2ZUlkKTtcblxuICAgICAgICBleHBlY3QobW9ja1Rva1N0b3ApLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGV4cGVjdC5hbnkoU3RyaW5nKSwge1xuICAgICAgICAgIGFwaWtleTogJ2tleScsXG4gICAgICAgICAgc2Vzc2lvbl9pZDogdGVzdFRva1Nlc3Npb24sXG4gICAgICAgICAgYXJjaGl2ZV9pZDogdGVzdFRva0FyY2hpdmVJZCxcbiAgICAgICAgfSk7XG4gICAgICAgIGV4cGVjdChyZXMpLnRvRXF1YWwoJ3N0b3AnKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIHRocm93IG9uIHdyb25nIHR5cGUnLCAoKSA9PiB7XG4gICAgICAgIGV4cGVjdCgoKSA9PiBuZXcgQ2xvdWRDbGllbnQodGVzdFNlc3Npb24pLnRva1N0b3AoJ3ZpZGVvYScsICdrZXknLCB0ZXN0VG9rU2Vzc2lvbiwgdGVzdFRva0FyY2hpdmVJZCkpLnRvVGhyb3dFcnJvcigpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXX0=
