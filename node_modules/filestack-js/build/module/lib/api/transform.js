/*
 * Copyright (c) 2018 by Filestack.
 * Some rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { Filelink } from './../filelink';
/**
 * @private
 */
var toSnakeCase = function (original) {
    var snakeCased = {};
    var keys = Object.keys(original);
    for (var i = 0; i < keys.length; i++) {
        var newKey = keys[i].split(/(?=[A-Z])/).join('_').toLowerCase();
        if (typeof original[keys[i]] === 'object' && !Array.isArray(original[keys[i]])) {
            snakeCased[newKey] = toSnakeCase(original[keys[i]]);
        }
        else {
            snakeCased[newKey] = original[keys[i]];
        }
    }
    return snakeCased;
};
/**
 * Align enum
 */
export var EAlignOptions;
(function (EAlignOptions) {
    EAlignOptions["left"] = "left";
    EAlignOptions["right"] = "right";
    EAlignOptions["center"] = "center";
    EAlignOptions["bottom"] = "bottom";
    EAlignOptions["top"] = "top";
})(EAlignOptions || (EAlignOptions = {}));
/**
 * Align enum with faces option
 */
export var EAlignFacesOptions;
(function (EAlignFacesOptions) {
    EAlignFacesOptions["left"] = "left";
    EAlignFacesOptions["right"] = "right";
    EAlignFacesOptions["center"] = "center";
    EAlignFacesOptions["bottom"] = "bottom";
    EAlignFacesOptions["top"] = "top";
    EAlignFacesOptions["faces"] = "faces";
})(EAlignFacesOptions || (EAlignFacesOptions = {}));
/**
 * Fit enum
 */
export var EFitOptions;
(function (EFitOptions) {
    EFitOptions["clip"] = "clip";
    EFitOptions["crop"] = "crop";
    EFitOptions["scale"] = "scale";
    EFitOptions["max"] = "max";
})(EFitOptions || (EFitOptions = {}));
/**
 * Blur enum
 */
export var EBlurMode;
(function (EBlurMode) {
    EBlurMode["linear"] = "linear";
    EBlurMode["gaussian"] = "gaussian";
})(EBlurMode || (EBlurMode = {}));
/**
 * Shapes enum
 */
export var EShapeType;
(function (EShapeType) {
    EShapeType["oval"] = "oval";
    EShapeType["rect"] = "rect";
})(EShapeType || (EShapeType = {}));
/**
 * Noise type enum
 */
export var ENoiseType;
(function (ENoiseType) {
    ENoiseType["none"] = "none";
    ENoiseType["low"] = "low";
    ENoiseType["medium"] = "medium";
    ENoiseType["high"] = "high";
})(ENoiseType || (ENoiseType = {}));
/**
 * Style type enum
 */
export var EStyleType;
(function (EStyleType) {
    EStyleType["artwork"] = "artwork";
    EStyleType["photo"] = "photo";
})(EStyleType || (EStyleType = {}));
/**
 * Color space enum
 */
export var EColorspaceType;
(function (EColorspaceType) {
    EColorspaceType["RGB"] = "RGB";
    EColorspaceType["CMYK"] = "CMYK";
    EColorspaceType["Input"] = "Input";
})(EColorspaceType || (EColorspaceType = {}));
/**
 * Crop faces options enum
 */
export var ECropfacesType;
(function (ECropfacesType) {
    ECropfacesType["thumb"] = "thumb";
    ECropfacesType["crop"] = "crop";
    ECropfacesType["fill"] = "fill";
})(ECropfacesType || (ECropfacesType = {}));
/**
 * SmartCrop mode options enum
 */
export var ESmartCropMode;
(function (ESmartCropMode) {
    ESmartCropMode["fit"] = "fit";
    ESmartCropMode["auto"] = "auto";
})(ESmartCropMode || (ESmartCropMode = {}));
export var EImageWatermarkPosition;
(function (EImageWatermarkPosition) {
    EImageWatermarkPosition["top"] = "top";
    EImageWatermarkPosition["middle"] = "middle";
    EImageWatermarkPosition["bottom"] = "bottom";
    EImageWatermarkPosition["left"] = "left";
    EImageWatermarkPosition["center"] = "center";
    EImageWatermarkPosition["right"] = "right";
})(EImageWatermarkPosition || (EImageWatermarkPosition = {}));
/**
 * Convert to format
 */
export var EVideoTypes;
(function (EVideoTypes) {
    EVideoTypes["h264"] = "h264";
    EVideoTypes["h264_hi"] = "h264.hi";
    EVideoTypes["webm"] = "webm";
    EVideoTypes["webm-hi"] = "webm.hi";
    EVideoTypes["ogg"] = "ogg";
    EVideoTypes["ogg-hi"] = "ogg.hi";
    EVideoTypes["hls-variant"] = "hls.variant";
    EVideoTypes["mp3"] = "mp3";
    EVideoTypes["oga"] = "oga";
    EVideoTypes["m4a"] = "m4a";
    EVideoTypes["aac"] = "aac";
    EVideoTypes["hls"] = "hls.variant.audio";
})(EVideoTypes || (EVideoTypes = {}));
export var EUrlscreenshotAgent;
(function (EUrlscreenshotAgent) {
    EUrlscreenshotAgent["desktop"] = "desktop";
    EUrlscreenshotAgent["mobile"] = "mobile";
})(EUrlscreenshotAgent || (EUrlscreenshotAgent = {}));
export var EUrlscreenshotMode;
(function (EUrlscreenshotMode) {
    EUrlscreenshotMode["all"] = "all";
    EUrlscreenshotMode["window"] = "window";
})(EUrlscreenshotMode || (EUrlscreenshotMode = {}));
export var EUrlscreenshotOrientation;
(function (EUrlscreenshotOrientation) {
    EUrlscreenshotOrientation["portrait"] = "portrait";
    EUrlscreenshotOrientation["landscape"] = "landscape";
})(EUrlscreenshotOrientation || (EUrlscreenshotOrientation = {}));
/**
 * Video storage location
 */
export var EVideoLocations;
(function (EVideoLocations) {
    EVideoLocations["s3"] = "s3";
    EVideoLocations["azure"] = "azure";
    EVideoLocations["gcs"] = "gcs";
    EVideoLocations["rackspace"] = "rackspace";
    EVideoLocations["dropbox"] = "dropbox";
})(EVideoLocations || (EVideoLocations = {}));
export var EVideoAccess;
(function (EVideoAccess) {
    EVideoAccess["private"] = "private";
    EVideoAccess["public"] = "public";
})(EVideoAccess || (EVideoAccess = {}));
export var EVideoAccessMode;
(function (EVideoAccessMode) {
    EVideoAccessMode["preserve"] = "preserve";
    EVideoAccessMode["constrain"] = "constrain";
    EVideoAccessMode["letterbox"] = "letterbox";
    EVideoAccessMode["pad"] = "pad";
    EVideoAccessMode["crop"] = "crop";
})(EVideoAccessMode || (EVideoAccessMode = {}));
/**
 * Creates filestack transform url.
 * Transform params can be provided in camelCase or snakeCase style
 *
 * @example
 * ```js
 * // camelCase
 * console.log(transform(session, {
 *    partialPixelate: {
 *      objects: [[10, 20, 200, 250], [275, 91, 500, 557]],
 *    },
 *  }, 'testfile'));
 * ```
 * result => https://cdn.filestackcontent.com/partial_pixelate=objects:[[10,20,200,250],[275,91,500,557]]/testfile
 *
 * ```js
 * // snake_case
 * console.log(transform(session, {
 *    partial_pixelate: {
 *      objects: [[10, 20, 200, 250], [275, 91, 500, 557]],
 *    },
 *  }, 'testfile'));
 * ```
 * result => https://cdn.filestackcontent.com/partial_pixelate=objects:[[10,20,200,250],[275,91,500,557]]/testfile
 *
 * Client.transform is deprecated. Use Filelink class instead
 *
 * @private
 * @throws Error
 * @param options Transformation options
 * @param url url, handle or array of elements
 */
export var transform = function (session, url, options, b64) {
    if (options === void 0) { options = {}; }
    if (b64 === void 0) { b64 = false; }
    options = toSnakeCase(options);
    if (session.policy && session.signature) {
        options.security = {
            policy: session.policy,
            signature: session.signature,
        };
    }
    var filelink = new Filelink(url, session.apikey);
    filelink.setCname(session.cname);
    filelink.setBase64(b64);
    Object.keys(options).forEach(function (key) {
        if (typeof options[key] === 'boolean' && !options[key] && key !== 'cache') {
            return;
        }
        filelink.addTask(key, options[key]);
    });
    return filelink.toString();
};

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9saWIvYXBpL3RyYW5zZm9ybS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7Ozs7O0dBZUc7QUFHSCxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRXpDOztHQUVHO0FBQ0gsSUFBTSxXQUFXLEdBQUcsVUFBQyxRQUFrQztJQUNyRCxJQUFJLFVBQVUsR0FBNkIsRUFBRSxDQUFDO0lBRTlDLElBQU0sSUFBSSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7SUFFbkMsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7UUFDcEMsSUFBSSxNQUFNLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7UUFFaEUsSUFBSSxPQUFPLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxRQUFRLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFO1lBQzlFLFVBQVUsQ0FBQyxNQUFNLENBQUMsR0FBRyxXQUFXLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDckQ7YUFBTTtZQUNMLFVBQVUsQ0FBQyxNQUFNLENBQUMsR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDeEM7S0FDRjtJQUVELE9BQU8sVUFBVSxDQUFDO0FBQ3BCLENBQUMsQ0FBQztBQUVGOztHQUVHO0FBQ0gsTUFBTSxDQUFOLElBQVksYUFNWDtBQU5ELFdBQVksYUFBYTtJQUN2Qiw4QkFBYSxDQUFBO0lBQ2IsZ0NBQWUsQ0FB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Q0FBQyxJQUFNLFNBQVMsR0FBRyxVQUFDLE9BQWdCLEVBQUUsR0FBc0IsRUFBRSxPQUE4QixFQUFFLEdBQW9CO0lBQXBELHdCQUFBLEVBQUEsWUFBOEI7SUFBRSxvQkFBQSxFQUFBLFdBQW9CO0lBQ3RILE9BQU8sR0FBRyxXQUFXLENBQUMsT0FBTyxDQUFDLENBQUM7SUFFL0IsSUFBSSxPQUFPLENBQUMsTUFBTSxJQUFJLE9BQU8sQ0FBQyxTQUFTLEVBQUU7UUFDdkMsT0FBTyxDQUFDLFFBQVEsR0FBRztZQUNqQixNQUFNLEVBQUUsT0FBTyxDQUFDLE1BQU07WUFDdEIsU0FBUyxFQUFFLE9BQU8sQ0FBQyxTQUFTO1NBQzdCLENBQUM7S0FDSDtJQUVELElBQU0sUUFBUSxHQUFHLElBQUksUUFBUSxDQUFDLEdBQUcsRUFBRSxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDbkQsUUFBUSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDakMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUV4QixNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxVQUFDLEdBQTJCO1FBQ3ZELElBQUksT0FBTyxPQUFPLENBQUMsR0FBRyxDQUFDLEtBQUssU0FBUyxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEdBQUcsS0FBSyxPQUFPLEVBQUU7WUFDekUsT0FBTztTQUNSO1FBRUQsUUFBUSxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFDdEMsQ0FBQyxDQUFDLENBQUM7SUFFSCxPQUFPLFFBQVEsQ0FBQyxRQUFRLEVBQUUsQ0FBQztBQUM3QixDQUFDLENBQUMiLCJmaWxlIjoibGliL2FwaS90cmFuc2Zvcm0uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogQ29weXJpZ2h0IChjKSAyMDE4IGJ5IEZpbGVzdGFjay5cbiAqIFNvbWUgcmlnaHRzIHJlc2VydmVkLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBTZXNzaW9uIH0gZnJvbSAnLi4vY2xpZW50JztcbmltcG9ydCB7IEZpbGVsaW5rIH0gZnJvbSAnLi8uLi9maWxlbGluayc7XG5cbi8qKlxuICogQHByaXZhdGVcbiAqL1xuY29uc3QgdG9TbmFrZUNhc2UgPSAob3JpZ2luYWw6IHsgW2luZGV4OiBzdHJpbmddOiBhbnkgfSk6IHsgW2luZGV4OiBzdHJpbmddOiBhbnkgfSA9PiB7XG4gIGxldCBzbmFrZUNhc2VkOiB7IFtpbmRleDogc3RyaW5nXTogYW55IH0gPSB7fTtcblxuICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMob3JpZ2luYWwpO1xuXG4gIGZvciAobGV0IGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykge1xuICAgIGxldCBuZXdLZXkgPSBrZXlzW2ldLnNwbGl0KC8oPz1bQS1aXSkvKS5qb2luKCdfJykudG9Mb3dlckNhc2UoKTtcblxuICAgIGlmICh0eXBlb2Ygb3JpZ2luYWxba2V5c1tpXV0gPT09ICdvYmplY3QnICYmICFBcnJheS5pc0FycmF5KG9yaWdpbmFsW2tleXNbaV1dKSkge1xuICAgICAgc25ha2VDYXNlZFtuZXdLZXldID0gdG9TbmFrZUNhc2Uob3JpZ2luYWxba2V5c1tpXV0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBzbmFrZUNhc2VkW25ld0tleV0gPSBvcmlnaW5hbFtrZXlzW2ldXTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gc25ha2VDYXNlZDtcbn07XG5cbi8qKlxuICogQWxpZ24gZW51bVxuICovXG5leHBvcnQgZW51bSBFQWxpZ25PcHRpb25zIHtcbiAgbGVmdCA9ICdsZWZ0JyxcbiAgcmlnaHQgPSAncmlnaHQnLFxuICBjZW50ZXIgPSAnY2VudGVyJyxcbiAgYm90dG9tID0gJ2JvdHRvbScsXG4gIHRvcCA9ICd0b3AnLFxufVxuXG4vKipcbiAqIEFsaWduIGVudW0gd2l0aCBmYWNlcyBvcHRpb25cbiAqL1xuZXhwb3J0IGVudW0gRUFsaWduRmFjZXNPcHRpb25zIHtcbiAgbGVmdCA9ICdsZWZ0JyxcbiAgcmlnaHQgPSAncmlnaHQnLFxuICBjZW50ZXIgPSAnY2VudGVyJyxcbiAgYm90dG9tID0gJ2JvdHRvbScsXG4gIHRvcCA9ICd0b3AnLFxuICBmYWNlcyA9ICdmYWNlcycsXG59XG5cbi8qKlxuICogRml0IGVudW1cbiAqL1xuZXhwb3J0IGVudW0gRUZpdE9wdGlvbnMge1xuICBjbGlwID0gJ2NsaXAnLFxuICBjcm9wID0gJ2Nyb3AnLFxuICBzY2FsZSA9ICdzY2FsZScsXG4gIG1heCA9ICdtYXgnLFxufVxuXG4vKipcbiAqIEJsdXIgZW51bVxuICovXG5leHBvcnQgZW51bSBFQmx1ck1vZGUge1xuICBsaW5lYXIgPSAnbGluZWFyJyxcbiAgZ2F1c3NpYW4gPSAnZ2F1c3NpYW4nLFxufVxuXG4vKipcbiAqIFNoYXBlcyBlbnVtXG4gKi9cbmV4cG9ydCBlbnVtIEVTaGFwZVR5cGUge1xuICBvdmFsID0gJ292YWwnLFxuICByZWN0ID0gJ3JlY3QnLFxufVxuXG4vKipcbiAqIE5vaXNlIHR5cGUgZW51bVxuICovXG5leHBvcnQgZW51bSBFTm9pc2VUeXBlIHtcbiAgbm9uZSA9ICdub25lJyxcbiAgbG93ID0gJ2xvdycsXG4gIG1lZGl1bSA9ICdtZWRpdW0nLFxuICBoaWdoID0gJ2hpZ2gnLFxufVxuXG4vKipcbiAqIFN0eWxlIHR5cGUgZW51bVxuICovXG5leHBvcnQgZW51bSBFU3R5bGVUeXBlIHtcbiAgYXJ0d29yayA9ICdhcnR3b3JrJyxcbiAgcGhvdG8gPSAncGhvdG8nLFxufVxuXG4vKipcbiAqIENvbG9yIHNwYWNlIGVudW1cbiAqL1xuZXhwb3J0IGVudW0gRUNvbG9yc3BhY2VUeXBlIHtcbiAgUkdCID0gJ1JHQicsXG4gIENNWUsgPSAnQ01ZSycsXG4gIElucHV0ID0gJ0lucHV0Jyxcbn1cblxuLyoqXG4gKiBDcm9wIGZhY2VzIG9wdGlvbnMgZW51bVxuICovXG5leHBvcnQgZW51bSBFQ3JvcGZhY2VzVHlwZSB7XG4gIHRodW1iID0gJ3RodW1iJyxcbiAgY3JvcCA9ICdjcm9wJyxcbiAgZmlsbCA9ICdmaWxsJyxcbn1cblxuLyoqXG4gKiBTbWFydENyb3AgbW9kZSBvcHRpb25zIGVudW1cbiAqL1xuZXhwb3J0IGVudW0gRVNtYXJ0Q3JvcE1vZGUge1xuICBmaXQgPSAnZml0JyxcbiAgYXV0byA9ICdhdXRvJyxcbn1cblxuZXhwb3J0IGVudW0gRUltYWdlV2F0ZXJtYXJrUG9zaXRpb24ge1xuICB0b3AgPSAndG9wJyxcbiAgbWlkZGxlID0gJ21pZGRsZScsXG4gIGJvdHRvbSA9ICdib3R0b20nLFxuICBsZWZ0ID0gJ2xlZnQnLFxuICBjZW50ZXIgPSAnY2VudGVyJyxcbiAgcmlnaHQgPSAncmlnaHQnLFxufVxuXG4vKipcbiAqIENvbnZlcnQgdG8gZm9ybWF0XG4gKi9cbmV4cG9ydCBlbnVtIEVWaWRlb1R5cGVzIHtcbiAgICBoMjY0ID0gJ2gyNjQnLFxuICAgIGgyNjRfaGkgPSAnaDI2NC5oaScsXG4gICAgd2VibSA9ICd3ZWJtJyxcbiAgICAnd2VibS1oaScgPSAnd2VibS5oaScsXG4gICAgb2dnID0gJ29nZycsXG4gICAgJ29nZy1oaScgPSAnb2dnLmhpJyxcbiAgICAnaGxzLXZhcmlhbnQnID0gJ2hscy52YXJpYW50JyxcbiAgICBtcDMgPSAnbXAzJyxcbiAgICBvZ2EgPSAnb2dhJyxcbiAgICBtNGEgPSAnbTRhJyxcbiAgICBhYWMgPSAnYWFjJyxcbiAgICBobHMgPSAnaGxzLnZhcmlhbnQuYXVkaW8nLFxufVxuXG5leHBvcnQgZW51bSBFVXJsc2NyZWVuc2hvdEFnZW50IHtcbiAgZGVza3RvcCA9ICdkZXNrdG9wJyxcbiAgbW9iaWxlID0gJ21vYmlsZScsXG59XG5cbmV4cG9ydCBlbnVtIEVVcmxzY3JlZW5zaG90TW9kZSB7XG4gIGFsbCA9ICdhbGwnLFxuICB3aW5kb3cgPSAnd2luZG93Jyxcbn1cblxuZXhwb3J0IGVudW0gRVVybHNjcmVlbnNob3RPcmllbnRhdGlvbiB7XG4gIHBvcnRyYWl0ID0gJ3BvcnRyYWl0JyxcbiAgbGFuZHNjYXBlID0gJ2xhbmRzY2FwZScsXG59XG5cbi8qKlxuICogVmlkZW8gc3RvcmFnZSBsb2NhdGlvblxuICovXG5leHBvcnQgZW51bSBFVmlkZW9Mb2NhdGlvbnMge1xuICBzMyA9ICdzMycsXG4gIGF6dXJlID0gJ2F6dXJlJyxcbiAgZ2NzID0gJ2djcycsXG4gIHJhY2tzcGFjZSA9ICdyYWNrc3BhY2UnLFxuICBkcm9wYm94ID0gJ2Ryb3Bib3gnLFxufVxuXG5leHBvcnQgZW51bSBFVmlkZW9BY2Nlc3Mge1xuICBwcml2YXRlID0gJ3ByaXZhdGUnLFxuICBwdWJsaWMgPSAncHVibGljJyxcbn1cblxuZXhwb3J0IGVudW0gRVZpZGVvQWNjZXNzTW9kZSB7XG4gIHByZXNlcnZlID0gJ3ByZXNlcnZlJyxcbiAgY29uc3RyYWluID0gJ2NvbnN0cmFpbicsXG4gIGxldHRlcmJveCA9ICdsZXR0ZXJib3gnLFxuICBwYWQgPSAncGFkJyxcbiAgY3JvcCA9ICdjcm9wJyxcbn1cblxuLyoqXG4gKiBAc2VlIGh0dHBzOi8vd3d3LmZpbGVzdGFjay5jb20vZG9jcy9pbWFnZS10cmFuc2Zvcm1hdGlvbnNcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBUcmFuc2Zvcm1PcHRpb25zIHtcbiAgZmxpcD86IGJvb2xlYW47XG4gIGNvbXByZXNzPzogYm9vbGVhbjtcbiAgZmxvcD86IGJvb2xlYW47XG4gIG5vX21ldGFkYXRhPzogYm9vbGVhbjtcbiAgcGpwZz86IHtcbiAgICBxdWFsaXR5OiBudW1iZXI7XG4gICAgbWV0YWRhdGE6IGJvb2xlYW47XG4gIH07XG4gIHNtYXJ0X2Nyb3A/OiB7XG4gICAgbW9kZT86IEVTbWFydENyb3BNb2RlXG4gICAgd2lkdGg6IG51bWJlcjtcbiAgICBoZWlnaHQ6IG51bWJlcjtcbiAgfTtcbiAgd2F0ZXJtYXJrPzoge1xuICAgIGZpbGVzOiBzdHJpbmc7XG4gICAgc2l6ZT86IG51bWJlcjtcbiAgICBwb3NpdGlvbj86IEVJbWFnZVdhdGVybWFya1Bvc2l0aW9uIHwgRUltYWdlV2F0ZXJtYXJrUG9zaXRpb25bXTtcbiAgfTtcbiAgaW1hZ2VzaXplPzogYm9vbGVhbjtcbiAgZW5jaGFuY2U/OiBib29sZWFuO1xuICByZWRleWU/OiBib29sZWFuO1xuICBtb25vY2hyb21lPzogYm9vbGVhbjtcbiAgbmVnYXRpdmU/OiBib29sZWFuO1xuICB0YWdzPzogYm9vbGVhbjtcbiAgc2Z3PzogYm9vbGVhbjtcbiAgc3RvcmU/OiB7XG4gICAgZmlsZW5hbWU/OiBzdHJpbmcsXG4gICAgbG9jYXRpb24/OiBzdHJpbmcsXG4gICAgcGF0aD86IHN0cmluZyxcbiAgICBjb250YWluZXI/OiBzdHJpbmcsXG4gICAgcmVnaW9uPzogc3RyaW5nO1xuICAgIGFjY2Vzcz86IHN0cmluZztcbiAgICBiYXNlNjRkZWNvZGU/OiBib29sZWFuO1xuICB9O1xuICByZXNpemU/OiB7XG4gICAgd2lkdGg/OiBudW1iZXI7XG4gICAgaGVpZ2h0PzogbnVtYmVyO1xuICAgIGZpdD86IEVGaXRPcHRpb25zO1xuICAgIGFsaWduPzogRUFsaWduRmFjZXNPcHRpb25zO1xuICB9O1xuICBjcm9wPzoge1xuICAgIGRpbTogW251bWJlciwgbnVtYmVyLCBudW1iZXIsIG51bWJlcl1cbiAgfTtcbiAgcm90YXRlPzoge1xuICAgIGRlZzogbnVtYmVyIHwgc3RyaW5nO1xuICAgIGNvbG9yPzogc3RyaW5nO1xuICAgIGJhY2tncm91bmQ/OiBzdHJpbmc7XG4gIH07XG4gIGRldGVjdF9mYWNlcz86IHtcbiAgICBtaW5zaXplPzogbnVtYmVyO1xuICAgIG1heHNpemU/OiBudW1iZXI7XG4gICAgY29sb3I/OiBzdHJpbmc7XG4gICAgZXhwb3J0PzogYm9vbGVhbjtcbiAgfSB8IHRydWU7XG4gIGNyb3BfZmFjZXM/OiB7XG4gICAgbW9kZT86IEVDcm9wZmFjZXNUeXBlO1xuICAgIHdpZHRoPzogbnVtYmVyO1xuICAgIGhlaWdodD86IG51bWJlcjtcbiAgICBmYWNlcz86IG51bWJlciB8IHN0cmluZztcbiAgICBidWZmZXI/OiBudW1iZXI7XG4gIH07XG4gIHBpeGVsYXRlX2ZhY2VzPzoge1xuICAgIGZhY2VzPzogbnVtYmVyIHwgc3RyaW5nO1xuICAgIG1pbnNpemU/OiBudW1iZXI7XG4gICAgbWF4c2l6ZT86IG51bWJlcjtcbiAgICBidWZmZXI/OiBudW1iZXI7XG4gICAgYW1vdW50PzogbnVtYmVyO1xuICAgIGJsdXI/OiBudW1iZXI7XG4gICAgdHlwZT86IEVTaGFwZVR5cGU7XG4gIH07XG4gIGJsdXJfZmFjZXM/OiB7XG4gICAgZmFjZXM/OiBudW1iZXIgfCBzdHJpbmc7XG4gICAgbWluc2l6ZT86IG51bWJlcjtcbiAgICBtYXhzaXplPzogbnVtYmVyO1xuICAgIGJ1ZmZlcj86IG51bWJlcjtcbiAgICBhbW91bnQ/OiBudW1iZXI7XG4gICAgYmx1cj86IG51bWJlcjtcbiAgICB0eXBlPzogRVNoYXBlVHlwZTtcbiAgfTtcbiAgcm91bmRlZF9jb3JuZXJzPzoge1xuICAgIHJhZGl1cz86IG51bWJlcjtcbiAgICBibHVyPzogbnVtYmVyO1xuICAgIGJhY2tncm91bmQ/OiBzdHJpbmc7XG4gIH0gfCB0cnVlO1xuICB2aWduZXR0ZT86IHtcbiAgICBhbW91bnQ/OiBudW1iZXI7XG4gICAgYmx1cm1vZGU/OiBFQmx1ck1vZGU7XG4gICAgYmFja2dyb3VuZD86IHN0cmluZztcbiAgfTtcbiAgcG9sYXJvaWQ/OiB7XG4gICAgY29sb3I/OiBzdHJpbmc7XG4gICAgcm90YXRlPzogbnVtYmVyO1xuICAgIGJhY2tncm91bmQ/OiBzdHJpbmc7XG4gIH0gfCB0cnVlO1xuICB0b3JuX2VkZ2VzPzoge1xuICAgIHNwcmVhZD86IFtudW1iZXIsIG51bWJlcl07XG4gICAgYmFja2dyb3VuZD86IHN0cmluZztcbiAgfSB8IHRydWU7XG4gIHNoYWRvdz86IHtcbiAgICBibHVyPzogbnVtYmVyO1xuICAgIG9wYWNpdHk/OiBudW1iZXI7XG4gICAgdmVjdG9yPzogW251bWJlciwgbnVtYmVyXTtcbiAgICBjb2xvcj86IHN0cmluZztcbiAgICBiYWNrZ3JvdW5kPzogc3RyaW5nO1xuICB9IHwgdHJ1ZTtcbiAgY2lyY2xlPzoge1xuICAgIGJhY2tncm91bmQ/OiBzdHJpbmc7XG4gIH0gfCB0cnVlO1xuICBib3JkZXI/OiB7XG4gICAgd2lkdGg/OiBudW1iZXI7XG4gICAgY29sb3I/OiBzdHJpbmc7XG4gICAgYmFja2dyb3VuZD86IHN0cmluZztcbiAgfSB8IHRydWU7XG4gIHNoYXJwZW4/OiB7XG4gICAgYW1vdW50OiBudW1iZXI7XG4gIH0gfCB0cnVlO1xuICBibHVyPzoge1xuICAgIGFtb3VudDogbnVtYmVyO1xuICB9IHwgdHJ1ZTtcbiAgYmxhY2t3aGl0ZT86IHtcbiAgICB0aHJlc2hvbGQ6IG51bWJlcjtcbiAgfSB8IHRydWU7XG4gIHNlcGlhPzoge1xuICAgIHRvbmU6IG51bWJlcjtcbiAgfSB8IHRydWU7XG4gIHBpeGVsYXRlPzoge1xuICAgIGFtb3VudDogbnVtYmVyO1xuICB9IHwgdHJ1ZTtcbiAgb2lsX3BhaW50Pzoge1xuICAgIGFtb3VudDogbnVtYmVyO1xuICB9IHwgdHJ1ZTtcbiAgbW9kdWxhdGU/OiB7XG4gICAgYnJpZ2h0bmVzcz86IG51bWJlcjtcbiAgICBodWU/OiBudW1iZXI7XG4gICAgc2F0dXJhdGlvbj86IG51bWJlcjtcbiAgfSB8IHRydWU7XG4gIHBhcnRpYWxfcGl4ZWxhdGU/OiB7XG4gICAgYW1vdW50PzogbnVtYmVyO1xuICAgIGJsdXI/OiBudW1iZXI7XG4gICAgdHlwZT86IEVTaGFwZVR5cGU7XG4gICAgb2JqZWN0cz86IFtbbnVtYmVyLCBudW1iZXIsIG51bWJlciwgbnVtYmVyXV07XG4gIH07XG4gIHBhcnRpYWxfYmx1cj86IHtcbiAgICBhbW91bnQ6IG51bWJlcjtcbiAgICBibHVyPzogbnVtYmVyO1xuICAgIHR5cGU/OiBFU2hhcGVUeXBlO1xuICAgIG9iamVjdHM/OiBbW251bWJlciwgbnVtYmVyLCBudW1iZXIsIG51bWJlcl1dO1xuICB9O1xuICBjb2xsYWdlPzoge1xuICAgIG1hcmdpbj86IG51bWJlcjtcbiAgICB3aWR0aD86IG51bWJlcjtcbiAgICBoZWlnaHQ/OiBudW1iZXI7XG4gICAgY29sb3I/OiBzdHJpbmc7XG4gICAgZml0PzogRUZpdE9wdGlvbnMsXG4gICAgZmlsZXM6IFtzdHJpbmddO1xuICB9O1xuICB1cHNjYWxlPzoge1xuICAgIHVwc2NhbGU/OiBib29sZWFuO1xuICAgIG5vaXNlPzogRU5vaXNlVHlwZTtcbiAgICBzdHlsZT86IEVTdHlsZVR5cGU7XG4gIH0gfCB0cnVlO1xuICBhc2NpaT86IHtcbiAgICBiYWNrZ3JvdW5kPzogc3RyaW5nO1xuICAgIGZvcmVncm91bmQ/OiBzdHJpbmc7XG4gICAgY29sb3JlZD86IGJvb2xlYW47XG4gICAgc2l6ZT86IG51bWJlcjtcbiAgICByZXZlcnNlPzogYm9vbGVhbjtcbiAgfSB8IHRydWU7XG4gIHF1YWxpdHk/OiB7XG4gICAgdmFsdWU6IG51bWJlcjtcbiAgfTtcbiAgc2VjdXJpdHk/OiB7XG4gICAgcG9saWN5OiBzdHJpbmc7XG4gICAgc2lnbmF0dXJlPzogc3RyaW5nO1xuICB9O1xuICBvdXRwdXQ/OiB7XG4gICAgZm9ybWF0OiBzdHJpbmc7XG4gICAgY29sb3JzcGFjZT86IHN0cmluZztcbiAgICBzdHJpcD86IGJvb2xlYW47XG4gICAgcXVhbGl0eT86IG51bWJlcjtcbiAgICBwYWdlPzogbnVtYmVyO1xuICAgIGNvbXByZXNzPzogYm9vbGVhbjtcbiAgICBkZW5zaXR5PzogbnVtYmVyO1xuICAgIGJhY2tncm91bmQ/OiBzdHJpbmc7XG4gICAgc2VjdXJlPzogYm9vbGVhbjtcbiAgICBkb2NpbmZvPzogYm9vbGVhbjtcbiAgICBwYWdlZm9ybWF0Pzogc3RyaW5nO1xuICAgIHBhZ2VvcmllbnRhdGlvbj86IHN0cmluZztcbiAgfTtcbiAgY2FjaGU/OiB7XG4gICAgY2FjaGU/OiBib29sZWFuO1xuICAgIGV4cGlyeTogbnVtYmVyO1xuICB9O1xuICAvLyBhdWRpby92aWRlb1xuICB2aWRlb19jb252ZXJ0Pzoge1xuICAgIGFzcGVjdF9tb2RlOiBFVmlkZW9BY2Nlc3NNb2RlO1xuICAgIHByZXNldD86IEVWaWRlb1R5cGVzO1xuICAgIGZvcmNlPzogYm9vbGVhbjtcbiAgICB0aXRsZT86IHN0cmluZztcbiAgICBleHRuYW1lPzogc3RyaW5nO1xuICAgIGZpbGVuYW1lPzogc3RyaW5nO1xuICAgIGxvY2F0aW9uPzogRVZpZGVvTG9jYXRpb25zO1xuICAgIHBhdGg/OiBzdHJpbmc7XG4gICAgYWNjZXNzPzogRVZpZGVvQWNjZXNzO1xuICAgIGNvbnRhaW5lcj86IHN0cmluZztcbiAgICBhdWRpb19iaXRyYXRlPzogbnVtYmVyO1xuICAgIHVwc2NhbGU6IGJvb2xlYW47XG4gICAgdmlkZW9fYml0cmF0ZT86IG51bWJlcjtcbiAgICBhdWRpb19zYW1wbGVfcmF0ZT86IG51bWJlcjtcbiAgICBhdWRpb19jaGFubmVscz86IG51bWJlcjtcbiAgICBjbGlwX2xlbmd0aD86IHN0cmluZztcbiAgICBjbGlwX29mZnNldD86IHN0cmluZztcbiAgICB3aWR0aD86IG51bWJlcjtcbiAgICBoZWlnaHQ/OiBudW1iZXI7XG4gICAgdHdvX3Bhc3M/OiBib29sZWFuO1xuICAgIGZwcz86IG51bWJlcjtcbiAgICBrZXlmcmFtZV9pbnRlcnZhbD86IG51bWJlcjtcbiAgICB3YXRlcm1hcmtfdXJsPzogc3RyaW5nO1xuICAgIHdhdGVybWFya190b3A/OiBudW1iZXI7XG4gICAgd2F0ZXJtYXJrX2JvdHRvbT86IG51bWJlcjtcbiAgICB3YXRlcm1hcmtfcmlnaHQ/OiBudW1iZXI7XG4gICAgd2F0ZXJtYXJrX2xlZnQ/OiBudW1iZXI7XG4gICAgd2F0ZXJtYXJrX3dpZHRoPzogbnVtYmVyO1xuICAgIHdhdGVybWFya19oZWlnaHQ/OiBudW1iZXI7XG4gIH07XG4gIHVybHNjcmVlbnNob3Q/OiB7XG4gICAgYWdlbnQ/OiBFVXJsc2NyZWVuc2hvdEFnZW50O1xuICAgIHdpZHRoPzogbnVtYmVyO1xuICAgIGhlaWdodD86IG51bWJlcjtcbiAgICBtb2RlPzogRVVybHNjcmVlbnNob3RNb2RlO1xuICAgIGRlbGF5PzogbnVtYmVyO1xuICAgIG9yaWVudGF0aW9uPzogRVVybHNjcmVlbnNob3RPcmllbnRhdGlvbjtcbiAgICBkZXZpY2U/OiBzdHJpbmc7XG4gIH0gfCB0cnVlO1xuICBwZGZpbmZvPzoge1xuICAgIGNvbG9yaW5mbz86IGJvb2xlYW5cbiAgfSB8IHRydWU7XG4gIHBkZmNvbnZlcnQ/OiB7XG4gICAgcGFnZW9yaWVudGF0aW9uPzogc3RyaW5nXG4gICAgcGFnZWZvcm1hdD86IHN0cmluZ1xuICAgIHBhZ2VzPzogKHN0cmluZyB8IG51bWJlcilbXVxuICB9O1xufVxuXG4vKipcbiAqIENyZWF0ZXMgZmlsZXN0YWNrIHRyYW5zZm9ybSB1cmwuXG4gKiBUcmFuc2Zvcm0gcGFyYW1zIGNhbiBiZSBwcm92aWRlZCBpbiBjYW1lbENhc2Ugb3Igc25ha2VDYXNlIHN0eWxlXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYGpzXG4gKiAvLyBjYW1lbENhc2VcbiAqIGNvbnNvbGUubG9nKHRyYW5zZm9ybShzZXNzaW9uLCB7XG4gKiAgICBwYXJ0aWFsUGl4ZWxhdGU6IHtcbiAqICAgICAgb2JqZWN0czogW1sxMCwgMjAsIDIwMCwgMjUwXSwgWzI3NSwgOTEsIDUwMCwgNTU3XV0sXG4gKiAgICB9LFxuICogIH0sICd0ZXN0ZmlsZScpKTtcbiAqIGBgYFxuICogcmVzdWx0ID0+IGh0dHBzOi8vY2RuLmZpbGVzdGFja2NvbnRlbnQuY29tL3BhcnRpYWxfcGl4ZWxhdGU9b2JqZWN0czpbWzEwLDIwLDIwMCwyNTBdLFsyNzUsOTEsNTAwLDU1N11dL3Rlc3RmaWxlXG4gKlxuICogYGBganNcbiAqIC8vIHNuYWtlX2Nhc2VcbiAqIGNvbnNvbGUubG9nKHRyYW5zZm9ybShzZXNzaW9uLCB7XG4gKiAgICBwYXJ0aWFsX3BpeGVsYXRlOiB7XG4gKiAgICAgIG9iamVjdHM6IFtbMTAsIDIwLCAyMDAsIDI1MF0sIFsyNzUsIDkxLCA1MDAsIDU1N11dLFxuICogICAgfSxcbiAqICB9LCAndGVzdGZpbGUnKSk7XG4gKiBgYGBcbiAqIHJlc3VsdCA9PiBodHRwczovL2Nkbi5maWxlc3RhY2tjb250ZW50LmNvbS9wYXJ0aWFsX3BpeGVsYXRlPW9iamVjdHM6W1sxMCwyMCwyMDAsMjUwXSxbMjc1LDkxLDUwMCw1NTddXS90ZXN0ZmlsZVxuICpcbiAqIENsaWVudC50cmFuc2Zvcm0gaXMgZGVwcmVjYXRlZC4gVXNlIEZpbGVsaW5rIGNsYXNzIGluc3RlYWRcbiAqXG4gKiBAcHJpdmF0ZVxuICogQHRocm93cyBFcnJvclxuICogQHBhcmFtIG9wdGlvbnMgVHJhbnNmb3JtYXRpb24gb3B0aW9uc1xuICogQHBhcmFtIHVybCB1cmwsIGhhbmRsZSBvciBhcnJheSBvZiBlbGVtZW50c1xuICovXG5leHBvcnQgY29uc3QgdHJhbnNmb3JtID0gKHNlc3Npb246IFNlc3Npb24sIHVybDogc3RyaW5nIHwgc3RyaW5nW10sIG9wdGlvbnM6IFRyYW5zZm9ybU9wdGlvbnMgPSB7fSwgYjY0OiBib29sZWFuID0gZmFsc2UpOiBzdHJpbmcgPT4ge1xuICBvcHRpb25zID0gdG9TbmFrZUNhc2Uob3B0aW9ucyk7XG5cbiAgaWYgKHNlc3Npb24ucG9saWN5ICYmIHNlc3Npb24uc2lnbmF0dXJlKSB7XG4gICAgb3B0aW9ucy5zZWN1cml0eSA9IHtcbiAgICAgIHBvbGljeTogc2Vzc2lvbi5wb2xpY3ksXG4gICAgICBzaWduYXR1cmU6IHNlc3Npb24uc2lnbmF0dXJlLFxuICAgIH07XG4gIH1cblxuICBjb25zdCBmaWxlbGluayA9IG5ldyBGaWxlbGluayh1cmwsIHNlc3Npb24uYXBpa2V5KTtcbiAgZmlsZWxpbmsuc2V0Q25hbWUoc2Vzc2lvbi5jbmFtZSk7XG4gIGZpbGVsaW5rLnNldEJhc2U2NChiNjQpO1xuXG4gIE9iamVjdC5rZXlzKG9wdGlvbnMpLmZvckVhY2goKGtleToga2V5b2YgVHJhbnNmb3JtT3B0aW9ucykgPT4ge1xuICAgIGlmICh0eXBlb2Ygb3B0aW9uc1trZXldID09PSAnYm9vbGVhbicgJiYgIW9wdGlvbnNba2V5XSAmJiBrZXkgIT09ICdjYWNoZScpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBmaWxlbGluay5hZGRUYXNrKGtleSwgb3B0aW9uc1trZXldKTtcbiAgfSk7XG5cbiAgcmV0dXJuIGZpbGVsaW5rLnRvU3RyaW5nKCk7XG59O1xuIl19
